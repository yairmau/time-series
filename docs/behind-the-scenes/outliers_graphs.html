<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Time Series Analysis - 59&nbsp; outliers graphs</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<link href="../behind-the-scenes/make_your_own_website.html" rel="next">
<link href="../behind-the-scenes/consecutive_sequence.html" rel="prev">
<link href="../archive/clock-history.png" rel="icon" type="image/png">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<link href="//netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
</head><body class="nav-sidebar floating"><div id="progress-bar" style="width: 0%; height:4px; background-color: rgb(89 127 235);; position: fixed; top: 0px; z-index: 2000;"></div>

<script id="progressbar" type="text/javascript">

document.addEventListener("DOMContentLoaded", function() {

    const bar = document.querySelector('#progress-bar');
    const post = document.querySelector('#quarto-content');
    const html = document.documentElement;
    
    const height = post.scrollHeight + post.offsetTop;
    
    window.addEventListener('scroll', () => {
        bar.style.width = (html.scrollTop / (height- html.clientHeight)) * 100 + '%';
    });
});
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script src="https://unpkg.com/@jupyter-widgets/html-manager@*/dist/embed-amd.js" crossorigin="anonymous"></script>






<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../behind-the-scenes/sliding-window-video.html">behind-the-scenes</a></li><li class="breadcrumb-item"><a href="../behind-the-scenes/outliers_graphs.html"><span class="chapter-number">59</span>&nbsp; <span class="chapter-title">outliers graphs</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header sidebar-header-stacked">
      <a href="../index.html" class="sidebar-logo-link">
      <img src="../archive/clock-history.png" alt="" class="sidebar-logo py-0 d-lg-inline d-none">
      </a>
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Time Series Analysis</a> 
        <div class="sidebar-tools-main tools-wide">
    <a href="https://yairmau.com/" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-house-fill"></i></a>
    <a href="../sources.html" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-bookmark-fill"></i></a>
    <a href="../things-to-remember.html" rel="" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-asterisk"></i></a>
    <a href="https://github.com/yairmau/time-series/" rel="" title="Source Code" class="quarto-navigation-tool px-1" aria-label="Source Code"><i class="bi bi-github"></i></a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">about</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../who-cares.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">who cares?</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true">
 <span class="menu-text">start here</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basics/boring.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">the boring stuff you absolutely need to do</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basics/numpy-pandas-matplotlib.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">numpy, pandas, matplotlib</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basics/example.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">learn by example</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../basics/AI-policy.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">AI policy</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true">
 <span class="menu-text">resampling</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../resampling/motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">motivation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../resampling/resampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">6</span>&nbsp; <span class="chapter-title">resampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../resampling/upsampling.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">7</span>&nbsp; <span class="chapter-title">upsampling</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../resampling/interpolation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">8</span>&nbsp; <span class="chapter-title">interpolation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../resampling/FAQ.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">9</span>&nbsp; <span class="chapter-title">FAQ</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true">
 <span class="menu-text">smoothing</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../smoothing/motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">10</span>&nbsp; <span class="chapter-title">motivation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../smoothing/sliding.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">11</span>&nbsp; <span class="chapter-title">sliding window</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../smoothing/not-only-averages.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">12</span>&nbsp; <span class="chapter-title">not only averages</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../smoothing/fit.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">13</span>&nbsp; <span class="chapter-title">fit</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../smoothing/savgol.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">14</span>&nbsp; <span class="chapter-title">Savitzky–Golay</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true">
 <span class="menu-text">outliers and gaps</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-4" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-4" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../outliers/motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">15</span>&nbsp; <span class="chapter-title">motivation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../outliers/outlier-identification.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">16</span>&nbsp; <span class="chapter-title">outlier identification</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../outliers/robust-analysis.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">17</span>&nbsp; <span class="chapter-title">robust analysis</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../outliers/sliding-algorithms.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">18</span>&nbsp; <span class="chapter-title">sliding algorithms</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../outliers/substituting-outliers.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">19</span>&nbsp; <span class="chapter-title">substituting outliers</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../outliers/outliers_challenge.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">20</span>&nbsp; <span class="chapter-title">challenge</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../outliers/outliers_challenge_part2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">21</span>&nbsp; <span class="chapter-title">challenge part 2</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true">
 <span class="menu-text">stationarity</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-5" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-5" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stationarity/motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">22</span>&nbsp; <span class="chapter-title">motivation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stationarity/random.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">23</span>&nbsp; <span class="chapter-title">random variables</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stationarity/AR.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">24</span>&nbsp; <span class="chapter-title">autoregressive processes</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stationarity/autocorrelation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">25</span>&nbsp; <span class="chapter-title">autocorrelation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stationarity/stationarity.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">26</span>&nbsp; <span class="chapter-title">stationarity</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stationarity/ACF_and_PACF_graphs.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">27</span>&nbsp; <span class="chapter-title">ACF and PACF graphs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stationarity/from_AR_to_ARIMA.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">28</span>&nbsp; <span class="chapter-title">from AR to ARIMA</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stationarity/practice.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">29</span>&nbsp; <span class="chapter-title">practice</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../stationarity/practice2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">30</span>&nbsp; <span class="chapter-title">filling missing values</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true">
 <span class="menu-text">seasonality</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-6" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-6" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../seasonality/motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">31</span>&nbsp; <span class="chapter-title">motivation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../seasonality/seasonal-decomposition-from-scratch.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">32</span>&nbsp; <span class="chapter-title">seasonal decomposition from scratch</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../seasonality/seasonal-decomposition.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">33</span>&nbsp; <span class="chapter-title">seasonal decomposition</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true">
 <span class="menu-text">time lags</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-7" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-7" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lags/motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">34</span>&nbsp; <span class="chapter-title">motivation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lags/cross-correlation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">35</span>&nbsp; <span class="chapter-title">cross-correlation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lags/dynamic-time-warp.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">36</span>&nbsp; <span class="chapter-title">dynamic time warp</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../lags/LDTW.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">37</span>&nbsp; <span class="chapter-title">LDTW</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true">
 <span class="menu-text">frequency</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-8" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-8" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../frequency/motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">38</span>&nbsp; <span class="chapter-title">motivation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../frequency/fourier.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">39</span>&nbsp; <span class="chapter-title">Fourier transform</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../frequency/filtering.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">40</span>&nbsp; <span class="chapter-title">filtering</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../frequency/nyquist.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">41</span>&nbsp; <span class="chapter-title">Nyquist-Shannon sampling theorem</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true">
 <span class="menu-text">rates of change</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-9" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-9" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rates-of-change/motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">42</span>&nbsp; <span class="chapter-title">motivation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rates-of-change/derivatives.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">43</span>&nbsp; <span class="chapter-title">derivatives</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rates-of-change/finite-differences.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">44</span>&nbsp; <span class="chapter-title">finite differences</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rates-of-change/fourier-based-derivatives.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">45</span>&nbsp; <span class="chapter-title">Fourier-based derivatives</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../rates-of-change/LOESS-based-derivatives.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">46</span>&nbsp; <span class="chapter-title">LOESS-based derivatives</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true">
 <span class="menu-text">forecasting</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-10" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-10" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../forecasting/motivation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">47</span>&nbsp; <span class="chapter-title">motivation</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../forecasting/arima.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">48</span>&nbsp; <span class="chapter-title">ARIMA</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="true">
 <span class="menu-text">assignments</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-11" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-11" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/assignment1.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">49</span>&nbsp; <span class="chapter-title">assignment 1</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../assignments/assignment2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">50</span>&nbsp; <span class="chapter-title">assignment 2</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" aria-expanded="true">
 <span class="menu-text">technical stuff</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-12" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-12" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../technical-stuff/technical-stuff.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">51</span>&nbsp; <span class="chapter-title">technical stuff</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../technical-stuff/datasets.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">52</span>&nbsp; <span class="chapter-title">datasets</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../technical-stuff/date-formatting.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">53</span>&nbsp; <span class="chapter-title">date formatting</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../technical-stuff/sources.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">54</span>&nbsp; <span class="chapter-title">sources</span></span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" aria-expanded="true">
 <span class="menu-text">behind-the-scenes</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-13" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-13" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../behind-the-scenes/sliding-window-video.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">55</span>&nbsp; <span class="chapter-title">sliding window video</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../behind-the-scenes/savgol-video.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">56</span>&nbsp; <span class="chapter-title">savgol video</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../behind-the-scenes/API-IMS.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">57</span>&nbsp; <span class="chapter-title">API to download data from IMS</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../behind-the-scenes/consecutive_sequence.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">58</span>&nbsp; <span class="chapter-title">remove consecutive values</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../behind-the-scenes/outliers_graphs.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">59</span>&nbsp; <span class="chapter-title">outliers graphs</span></span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../behind-the-scenes/make_your_own_website.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">make your own website</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#define-functions" id="toc-define-functions" class="nav-link active" data-scroll-target="#define-functions"><span class="header-section-number">59.1</span> define functions</a></li>
  <li><a href="#load-and-process-data" id="toc-load-and-process-data" class="nav-link" data-scroll-target="#load-and-process-data"><span class="header-section-number">59.2</span> load and process data</a></li>
  <li><a href="#stationary-signal" id="toc-stationary-signal" class="nav-link" data-scroll-target="#stationary-signal"><span class="header-section-number">59.3</span> stationary signal</a></li>
  <li><a href="#visual-inspection" id="toc-visual-inspection" class="nav-link" data-scroll-target="#visual-inspection"><span class="header-section-number">59.4</span> visual inspection</a></li>
  <li><a href="#mean---3-std" id="toc-mean---3-std" class="nav-link" data-scroll-target="#mean---3-std"><span class="header-section-number">59.5</span> mean +- 3 std</a></li>
  <li><a href="#iqr" id="toc-iqr" class="nav-link" data-scroll-target="#iqr"><span class="header-section-number">59.6</span> IQR</a></li>
  <li><a href="#non-stationary-signal" id="toc-non-stationary-signal" class="nav-link" data-scroll-target="#non-stationary-signal"><span class="header-section-number">59.7</span> non stationary signal</a></li>
  <li><a href="#running---3-std" id="toc-running---3-std" class="nav-link" data-scroll-target="#running---3-std"><span class="header-section-number">59.8</span> running +- 3 std</a></li>
  <li><a href="#running-q---iqr" id="toc-running-q---iqr" class="nav-link" data-scroll-target="#running-q---iqr"><span class="header-section-number">59.9</span> running: Q +- IQR</a></li>
  <li><a href="#hampel-running-mad" id="toc-hampel-running-mad" class="nav-link" data-scroll-target="#hampel-running-mad"><span class="header-section-number">59.10</span> Hampel, running MAD</a></li>
  <li><a href="#stationary-mad" id="toc-stationary-mad" class="nav-link" data-scroll-target="#stationary-mad"><span class="header-section-number">59.11</span> stationary MAD</a></li>
  <li><a href="#save-data-as-csv-for-later-usage" id="toc-save-data-as-csv-for-later-usage" class="nav-link" data-scroll-target="#save-data-as-csv-for-later-usage"><span class="header-section-number">59.12</span> save data as csv for later usage</a></li>
  <li><a href="#generate-datasets" id="toc-generate-datasets" class="nav-link" data-scroll-target="#generate-datasets"><span class="header-section-number">59.13</span> generate datasets</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<div class="quarto-title-block"><div><h1 class="title"><span class="chapter-number">59</span>&nbsp; <span class="chapter-title">outliers graphs</span></h1><button type="button" class="btn code-tools-button" id="quarto-code-tools-source" data-quarto-source-url="https://github.com/yairmau/time-series/blob/main/behind-the-scenes/outliers_graphs.ipynb"><i class="bi"></i> Code</button></div></div>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="im">import</span> warnings</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="im">import</span> numpy <span class="im">as</span> np </span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-6"><a href="#cb1-6"></a>sns.<span class="bu">set</span>(style<span class="op">=</span><span class="st">"ticks"</span>, font_scale<span class="op">=</span><span class="fl">1.5</span>)  <span class="co"># white graphs, with large and legible letters</span></span>
<span id="cb1-7"><a href="#cb1-7"></a>warnings.simplefilter(action<span class="op">=</span><span class="st">'ignore'</span>, category<span class="op">=</span><span class="pp">FutureWarning</span>)</span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="im">import</span> matplotlib.gridspec <span class="im">as</span> gridspec</span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="im">from</span> matplotlib.dates <span class="im">import</span> DateFormatter</span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="im">import</span> matplotlib.dates <span class="im">as</span> mdates</span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="im">from</span> scipy.stats <span class="im">import</span> median_abs_deviation</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>https://www.google.com/imgres?imgurl=https%3A%2F%2Fcxl.com%2Fwp-content%2Fuploads%2F2017%2F01%2Fchart-1.png&amp;tbnid=RClfEFYNWm0WWM&amp;vet=12ahUKEwjsx9KiqtKDAxXwh_0HHQR0CPoQMygSegQIARB1..i&amp;imgrefurl=https%3A%2F%2Fcxl.com%2Fblog%2Foutliers%2F&amp;docid=EVGldozQCNsxLM&amp;w=1662&amp;h=722&amp;q=outliers%20different%20distributions&amp;client=safari&amp;ved=2ahUKEwjsx9KiqtKDAxXwh_0HHQR0CPoQMygSegQIARB1</p>
<p>source: https://github.com/erykml/medium_articles/blob/master/Machine%20Learning/outlier_detection_hampel_filter.ipynb</p>
<section id="define-functions" class="level2" data-number="59.1">
<h2 data-number="59.1" class="anchored" data-anchor-id="define-functions"><span class="header-section-number">59.1</span> define functions</h2>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">def</span> random_walk_with_outliers(origin, n_steps, perc_outliers<span class="op">=</span><span class="fl">0.0</span>, outlier_mult<span class="op">=</span><span class="dv">10</span>, seed<span class="op">=</span><span class="dv">42</span>):</span>
<span id="cb2-2"><a href="#cb2-2"></a>    <span class="co">'''</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="co">    Function for generating a random time series based on random walk.</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="co">    It adds a specified percentage of outliers by multiplying the random walk step by a scalar.</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="co">    </span></span>
<span id="cb2-6"><a href="#cb2-6"></a><span class="co">    Parameters</span></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="co">    ------------</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="co">    origin : int</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="co">        The starting point of the series</span></span>
<span id="cb2-10"><a href="#cb2-10"></a><span class="co">    n_steps : int</span></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co">        Lenght of the series</span></span>
<span id="cb2-12"><a href="#cb2-12"></a><span class="co">    perc_outliers : float</span></span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">        Percentage of outliers to introduce to the series [0.0-1.0]</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co">    outlier_mult : float</span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co">        Scalar by which to multiply the RW increment to create an outlier</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="co">    seed : int</span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co">        Random seed</span></span>
<span id="cb2-18"><a href="#cb2-18"></a></span>
<span id="cb2-19"><a href="#cb2-19"></a><span class="co">    Returns</span></span>
<span id="cb2-20"><a href="#cb2-20"></a><span class="co">    -----------</span></span>
<span id="cb2-21"><a href="#cb2-21"></a><span class="co">    rw : np.ndarray</span></span>
<span id="cb2-22"><a href="#cb2-22"></a><span class="co">        The generated random walk series with outliers</span></span>
<span id="cb2-23"><a href="#cb2-23"></a><span class="co">    indices : np.ndarray</span></span>
<span id="cb2-24"><a href="#cb2-24"></a><span class="co">        The indices of the introduced outliers </span></span>
<span id="cb2-25"><a href="#cb2-25"></a><span class="co">    '''</span></span>
<span id="cb2-26"><a href="#cb2-26"></a>    <span class="cf">assert</span> (perc_outliers <span class="op">&gt;=</span> <span class="fl">0.0</span>) <span class="op">&amp;</span> (perc_outliers <span class="op">&lt;=</span> <span class="fl">1.0</span>)</span>
<span id="cb2-27"><a href="#cb2-27"></a>    </span>
<span id="cb2-28"><a href="#cb2-28"></a>    <span class="co">#set seed for reproducibility</span></span>
<span id="cb2-29"><a href="#cb2-29"></a>    np.random.seed(seed)</span>
<span id="cb2-30"><a href="#cb2-30"></a>    </span>
<span id="cb2-31"><a href="#cb2-31"></a>    <span class="co"># possible steps</span></span>
<span id="cb2-32"><a href="#cb2-32"></a>    steps <span class="op">=</span> [<span class="op">-</span><span class="dv">1</span>, <span class="dv">1</span>]</span>
<span id="cb2-33"><a href="#cb2-33"></a></span>
<span id="cb2-34"><a href="#cb2-34"></a>    <span class="co"># simulate steps</span></span>
<span id="cb2-35"><a href="#cb2-35"></a>    steps <span class="op">=</span> np.random.choice(a<span class="op">=</span>steps, size<span class="op">=</span>n_steps<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb2-36"><a href="#cb2-36"></a>    rw <span class="op">=</span> np.append(origin, steps).cumsum(<span class="dv">0</span>)</span>
<span id="cb2-37"><a href="#cb2-37"></a>    </span>
<span id="cb2-38"><a href="#cb2-38"></a>    <span class="co"># add outliers</span></span>
<span id="cb2-39"><a href="#cb2-39"></a>    n_outliers <span class="op">=</span> <span class="bu">int</span>(np.<span class="bu">round</span>(perc_outliers <span class="op">*</span> n_steps, <span class="dv">0</span>))</span>
<span id="cb2-40"><a href="#cb2-40"></a>    indices <span class="op">=</span> np.random.randint(<span class="dv">0</span>, <span class="bu">len</span>(rw), n_outliers)</span>
<span id="cb2-41"><a href="#cb2-41"></a>    rw[indices] <span class="op">=</span> rw[indices] <span class="op">+</span> steps[indices <span class="op">+</span> <span class="dv">1</span>] <span class="op">*</span> outlier_mult</span>
<span id="cb2-42"><a href="#cb2-42"></a>    </span>
<span id="cb2-43"><a href="#cb2-43"></a>    <span class="cf">return</span> rw, indices</span>
<span id="cb2-44"><a href="#cb2-44"></a></span>
<span id="cb2-45"><a href="#cb2-45"></a><span class="kw">def</span> concise(ax):</span>
<span id="cb2-46"><a href="#cb2-46"></a>    locator <span class="op">=</span> mdates.AutoDateLocator(minticks<span class="op">=</span><span class="dv">3</span>, maxticks<span class="op">=</span><span class="dv">7</span>)</span>
<span id="cb2-47"><a href="#cb2-47"></a>    formatter <span class="op">=</span> mdates.ConciseDateFormatter(locator)</span>
<span id="cb2-48"><a href="#cb2-48"></a>    ax.xaxis.set_major_locator(locator)</span>
<span id="cb2-49"><a href="#cb2-49"></a>    ax.xaxis.set_major_formatter(formatter)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="load-and-process-data" class="level2" data-number="59.2">
<h2 data-number="59.2" class="anchored" data-anchor-id="load-and-process-data"><span class="header-section-number">59.2</span> load and process data</h2>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1"></a>start <span class="op">=</span> <span class="st">'2023-01-10 00:00:00'</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>n_steps <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb3-3"><a href="#cb3-3"></a>rw39, outlier_ind39 <span class="op">=</span> random_walk_with_outliers(origin<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb3-4"><a href="#cb3-4"></a>                                            n_steps<span class="op">=</span>n_steps,</span>
<span id="cb3-5"><a href="#cb3-5"></a>                                            perc_outliers<span class="op">=</span><span class="fl">0.0031</span>,</span>
<span id="cb3-6"><a href="#cb3-6"></a>                                            outlier_mult<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb3-7"><a href="#cb3-7"></a>                                            seed<span class="op">=</span><span class="dv">39</span>)</span>
<span id="cb3-8"><a href="#cb3-8"></a>date_range <span class="op">=</span> pd.date_range(start, periods<span class="op">=</span>n_steps, freq<span class="op">=</span><span class="st">'1min'</span>)</span>
<span id="cb3-9"><a href="#cb3-9"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'date'</span>: date_range, <span class="st">'signal'</span>: rw39}).set_index(<span class="st">'date'</span>)</span>
<span id="cb3-10"><a href="#cb3-10"></a>start <span class="op">=</span> df.index[<span class="dv">0</span>]</span>
<span id="cb3-11"><a href="#cb3-11"></a>end <span class="op">=</span> df.index[<span class="op">-</span><span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1"></a>rw40, outlier_ind40 <span class="op">=</span> random_walk_with_outliers(origin<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb4-2"><a href="#cb4-2"></a>                                            n_steps<span class="op">=</span>n_steps,</span>
<span id="cb4-3"><a href="#cb4-3"></a>                                            perc_outliers<span class="op">=</span><span class="fl">0.0031</span>,</span>
<span id="cb4-4"><a href="#cb4-4"></a>                                            outlier_mult<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb4-5"><a href="#cb4-5"></a>                                            seed<span class="op">=</span><span class="dv">40</span>)</span>
<span id="cb4-6"><a href="#cb4-6"></a>df[<span class="st">'signal40'</span>] <span class="op">=</span> rw40</span>
<span id="cb4-7"><a href="#cb4-7"></a></span>
<span id="cb4-8"><a href="#cb4-8"></a>df.loc[<span class="st">'2023-01-10 04:40:00'</span>, <span class="st">'signal40'</span>] <span class="op">=</span> <span class="fl">43.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="5">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1"></a><span class="co"># rw41, outlier_ind41 = random_walk_with_outliers(origin=0,</span></span>
<span id="cb5-2"><a href="#cb5-2"></a><span class="co">#                                             n_steps=n_steps,</span></span>
<span id="cb5-3"><a href="#cb5-3"></a><span class="co">#                                             perc_outliers=0.0031,</span></span>
<span id="cb5-4"><a href="#cb5-4"></a><span class="co">#                                             outlier_mult=50,</span></span>
<span id="cb5-5"><a href="#cb5-5"></a><span class="co">#                                             seed=41)</span></span>
<span id="cb5-6"><a href="#cb5-6"></a><span class="co"># df['signal41'] = rw41</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="stationary-signal" class="level2" data-number="59.3">
<h2 data-number="59.3" class="anchored" data-anchor-id="stationary-signal"><span class="header-section-number">59.3</span> stationary signal</h2>
<div class="cell" data-execution_count="6">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>))</span>
<span id="cb6-2"><a href="#cb6-2"></a><span class="co"># plot signal</span></span>
<span id="cb6-3"><a href="#cb6-3"></a>ax.plot(df[<span class="st">'signal'</span>], color<span class="op">=</span><span class="st">"tab:blue"</span>)</span>
<span id="cb6-4"><a href="#cb6-4"></a><span class="co"># make graph look nice</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>ax.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">'values'</span>,</span>
<span id="cb6-6"><a href="#cb6-6"></a>       xlim<span class="op">=</span>[start,end],</span>
<span id="cb6-7"><a href="#cb6-7"></a>       title<span class="op">=</span><span class="st">"a stationary signal"</span>,</span>
<span id="cb6-8"><a href="#cb6-8"></a>       ylim<span class="op">=</span>[<span class="op">-</span><span class="dv">45</span>, <span class="dv">80</span>])</span>
<span id="cb6-9"><a href="#cb6-9"></a>concise(ax)</span>
<span id="cb6-10"><a href="#cb6-10"></a>fig.savefig(<span class="st">"signal_39_stationary.png"</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="outliers_graphs_files/figure-html/cell-7-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="visual-inspection" class="level2" data-number="59.4">
<h2 data-number="59.4" class="anchored" data-anchor-id="visual-inspection"><span class="header-section-number">59.4</span> visual inspection</h2>
<div class="cell" data-execution_count="7">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>))</span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="co"># plot signal</span></span>
<span id="cb7-3"><a href="#cb7-3"></a>ax.plot(df[<span class="st">'signal'</span>], color<span class="op">=</span><span class="st">"tab:blue"</span>)</span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="co"># plot horizontal lines</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>ax.plot([start, end], [<span class="dv">40</span>]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb7-6"><a href="#cb7-6"></a>ax.text(end, <span class="dv">40</span>, <span class="st">" 40"</span>, va<span class="op">=</span><span class="st">"center"</span>)</span>
<span id="cb7-7"><a href="#cb7-7"></a>ax.plot([start, end], [<span class="op">-</span><span class="dv">30</span>]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb7-8"><a href="#cb7-8"></a>ax.text(end, <span class="op">-</span><span class="dv">30</span>, <span class="st">" -30"</span>, va<span class="op">=</span><span class="st">"center"</span>)</span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co"># find and plot outliers</span></span>
<span id="cb7-10"><a href="#cb7-10"></a>outliers_index <span class="op">=</span> df.index[(df[<span class="st">'signal'</span>] <span class="op">&gt;</span> <span class="dv">40</span>) <span class="op">|</span> (df[<span class="st">'signal'</span>] <span class="op">&lt;</span> <span class="op">-</span><span class="dv">30</span>)]</span>
<span id="cb7-11"><a href="#cb7-11"></a>ax.plot(df.loc[outliers_index, <span class="st">'signal'</span>], ls<span class="op">=</span><span class="st">'None'</span>,</span>
<span id="cb7-12"><a href="#cb7-12"></a>        marker<span class="op">=</span><span class="st">'o'</span>, markerfacecolor<span class="op">=</span><span class="st">'yellow'</span>, markersize<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb7-13"><a href="#cb7-13"></a>        markeredgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb7-14"><a href="#cb7-14"></a><span class="co"># make graph look nice</span></span>
<span id="cb7-15"><a href="#cb7-15"></a>ax.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">'values'</span>,</span>
<span id="cb7-16"><a href="#cb7-16"></a>       xlim<span class="op">=</span>[start,end],</span>
<span id="cb7-17"><a href="#cb7-17"></a>       title<span class="op">=</span><span class="st">"visual inspection"</span>,</span>
<span id="cb7-18"><a href="#cb7-18"></a>       ylim<span class="op">=</span>[<span class="op">-</span><span class="dv">45</span>, <span class="dv">80</span>])</span>
<span id="cb7-19"><a href="#cb7-19"></a>concise(ax)</span>
<span id="cb7-20"><a href="#cb7-20"></a>fig.savefig(<span class="st">"outliers_visual_inspection.png"</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="outliers_graphs_files/figure-html/cell-8-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="mean---3-std" class="level2" data-number="59.5">
<h2 data-number="59.5" class="anchored" data-anchor-id="mean---3-std"><span class="header-section-number">59.5</span> mean +- 3 std</h2>
<div class="cell" data-execution_count="8">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>))</span>
<span id="cb8-2"><a href="#cb8-2"></a>gs <span class="op">=</span> gridspec.GridSpec(<span class="dv">1</span>, <span class="dv">2</span>, width_ratios<span class="op">=</span>[<span class="dv">1</span>, <span class="fl">0.2</span>], height_ratios<span class="op">=</span>[<span class="dv">1</span>])</span>
<span id="cb8-3"><a href="#cb8-3"></a>gs.update(left<span class="op">=</span><span class="fl">0.10</span>, right<span class="op">=</span><span class="fl">0.90</span>, top<span class="op">=</span><span class="fl">0.95</span>, bottom<span class="op">=</span><span class="fl">0.13</span>,</span>
<span id="cb8-4"><a href="#cb8-4"></a>          hspace<span class="op">=</span><span class="fl">0.02</span>, wspace<span class="op">=</span><span class="fl">0.02</span>)</span>
<span id="cb8-5"><a href="#cb8-5"></a></span>
<span id="cb8-6"><a href="#cb8-6"></a>ax0 <span class="op">=</span> plt.subplot(gs[<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb8-7"><a href="#cb8-7"></a>ax1 <span class="op">=</span> plt.subplot(gs[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb8-8"><a href="#cb8-8"></a></span>
<span id="cb8-9"><a href="#cb8-9"></a>avg <span class="op">=</span> df[<span class="st">'signal'</span>].mean()</span>
<span id="cb8-10"><a href="#cb8-10"></a>std <span class="op">=</span> df[<span class="st">'signal'</span>].std()</span>
<span id="cb8-11"><a href="#cb8-11"></a></span>
<span id="cb8-12"><a href="#cb8-12"></a><span class="co"># plot signal</span></span>
<span id="cb8-13"><a href="#cb8-13"></a>ax0.plot(df[<span class="st">'signal'</span>], color<span class="op">=</span><span class="st">"tab:blue"</span>)</span>
<span id="cb8-14"><a href="#cb8-14"></a></span>
<span id="cb8-15"><a href="#cb8-15"></a>sns.kdeplot(data<span class="op">=</span>df, y<span class="op">=</span><span class="st">'signal'</span>, shade<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb8-16"><a href="#cb8-16"></a></span>
<span id="cb8-17"><a href="#cb8-17"></a>pdf_xlim <span class="op">=</span> ax1.get_xlim()</span>
<span id="cb8-18"><a href="#cb8-18"></a><span class="co"># plot horizontal lines</span></span>
<span id="cb8-19"><a href="#cb8-19"></a><span class="co"># mean</span></span>
<span id="cb8-20"><a href="#cb8-20"></a>ax0.plot([start, end], [avg]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, zorder<span class="op">=-</span><span class="dv">10</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb8-21"><a href="#cb8-21"></a>ax1.plot(pdf_xlim, [avg]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb8-22"><a href="#cb8-22"></a>ax1.text(<span class="fl">1.1</span><span class="op">*</span>pdf_xlim[<span class="dv">1</span>], avg, <span class="st">"mean"</span>, va<span class="op">=</span><span class="st">"center"</span>)</span>
<span id="cb8-23"><a href="#cb8-23"></a><span class="co"># mean + std</span></span>
<span id="cb8-24"><a href="#cb8-24"></a>ax0.plot([start, end], [avg<span class="op">+</span>std]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb8-25"><a href="#cb8-25"></a>ax1.plot(pdf_xlim, [avg<span class="op">+</span>std]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb8-26"><a href="#cb8-26"></a>ax1.text(<span class="fl">1.1</span><span class="op">*</span>pdf_xlim[<span class="dv">1</span>], avg<span class="op">+</span>std, <span class="vs">r"mean$+$std"</span>, va<span class="op">=</span><span class="st">"center"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb8-27"><a href="#cb8-27"></a><span class="co"># mean - std</span></span>
<span id="cb8-28"><a href="#cb8-28"></a>ax0.plot([start, end], [avg<span class="op">-</span>std]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb8-29"><a href="#cb8-29"></a>ax1.plot(pdf_xlim, [avg<span class="op">-</span>std]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb8-30"><a href="#cb8-30"></a>ax1.text(<span class="fl">1.1</span><span class="op">*</span>pdf_xlim[<span class="dv">1</span>], avg<span class="op">-</span>std, <span class="vs">r"mean$-$std"</span>, va<span class="op">=</span><span class="st">"center"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb8-31"><a href="#cb8-31"></a></span>
<span id="cb8-32"><a href="#cb8-32"></a>n_sigma <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb8-33"><a href="#cb8-33"></a><span class="co"># mean + 3std</span></span>
<span id="cb8-34"><a href="#cb8-34"></a>ax0.plot([start, end], [avg<span class="op">+</span>n_sigma<span class="op">*</span>std]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"tab:red"</span>)</span>
<span id="cb8-35"><a href="#cb8-35"></a>ax1.plot(pdf_xlim, [avg<span class="op">+</span>n_sigma<span class="op">*</span>std]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"tab:red"</span>)</span>
<span id="cb8-36"><a href="#cb8-36"></a>ax1.text(<span class="fl">1.1</span><span class="op">*</span>pdf_xlim[<span class="dv">1</span>], avg<span class="op">+</span>n_sigma<span class="op">*</span>std, <span class="vs">r"mean$+3\cdot$std"</span>, va<span class="op">=</span><span class="st">"center"</span>, color<span class="op">=</span><span class="st">"tab:red"</span>)</span>
<span id="cb8-37"><a href="#cb8-37"></a><span class="co"># mean - 3std</span></span>
<span id="cb8-38"><a href="#cb8-38"></a>ax0.plot([start, end], [avg<span class="op">-</span>n_sigma<span class="op">*</span>std]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"tab:red"</span>)</span>
<span id="cb8-39"><a href="#cb8-39"></a>ax1.plot(pdf_xlim, [avg<span class="op">-</span>n_sigma<span class="op">*</span>std]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"tab:red"</span>)</span>
<span id="cb8-40"><a href="#cb8-40"></a>ax1.text(<span class="fl">1.1</span><span class="op">*</span>pdf_xlim[<span class="dv">1</span>], avg<span class="op">-</span>n_sigma<span class="op">*</span>std, <span class="vs">r"mean$-3\cdot$std"</span>, va<span class="op">=</span><span class="st">"center"</span>, color<span class="op">=</span><span class="st">"tab:red"</span>)</span>
<span id="cb8-41"><a href="#cb8-41"></a></span>
<span id="cb8-42"><a href="#cb8-42"></a><span class="co"># find and plot outliers</span></span>
<span id="cb8-43"><a href="#cb8-43"></a>outliers_index <span class="op">=</span> df.index[(df[<span class="st">'signal'</span>] <span class="op">&gt;</span> avg <span class="op">+</span> n_sigma<span class="op">*</span>std) <span class="op">|</span> </span>
<span id="cb8-44"><a href="#cb8-44"></a>                          (df[<span class="st">'signal'</span>] <span class="op">&lt;</span> avg <span class="op">-</span> n_sigma<span class="op">*</span>std)</span>
<span id="cb8-45"><a href="#cb8-45"></a>                         ]</span>
<span id="cb8-46"><a href="#cb8-46"></a>ax0.plot(df.loc[outliers_index, <span class="st">'signal'</span>], ls<span class="op">=</span><span class="st">'None'</span>,</span>
<span id="cb8-47"><a href="#cb8-47"></a>        marker<span class="op">=</span><span class="st">'o'</span>, markerfacecolor<span class="op">=</span><span class="st">'yellow'</span>, markersize<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb8-48"><a href="#cb8-48"></a>        markeredgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb8-49"><a href="#cb8-49"></a><span class="co"># make graph look nice</span></span>
<span id="cb8-50"><a href="#cb8-50"></a>ax0.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">'values'</span>,</span>
<span id="cb8-51"><a href="#cb8-51"></a>       xlim<span class="op">=</span>[start,end],</span>
<span id="cb8-52"><a href="#cb8-52"></a>       ylim<span class="op">=</span>[<span class="op">-</span><span class="dv">45</span>, <span class="dv">80</span>],</span>
<span id="cb8-53"><a href="#cb8-53"></a>       title<span class="op">=</span><span class="vs">r"threshold: mean $\pm3$ std"</span>,</span>
<span id="cb8-54"><a href="#cb8-54"></a>       )</span>
<span id="cb8-55"><a href="#cb8-55"></a>concise(ax0)</span>
<span id="cb8-56"><a href="#cb8-56"></a>ax1.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'pdf'</span>,</span>
<span id="cb8-57"><a href="#cb8-57"></a>        ylabel<span class="op">=</span><span class="st">''</span>,</span>
<span id="cb8-58"><a href="#cb8-58"></a>        ylim<span class="op">=</span>[<span class="op">-</span><span class="dv">45</span>, <span class="dv">80</span>],</span>
<span id="cb8-59"><a href="#cb8-59"></a>        yticks<span class="op">=</span>[],</span>
<span id="cb8-60"><a href="#cb8-60"></a>        xticks<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">0.03</span>],</span>
<span id="cb8-61"><a href="#cb8-61"></a>        xticklabels<span class="op">=</span>[<span class="st">'0'</span>, <span class="st">'0.03'</span>]</span>
<span id="cb8-62"><a href="#cb8-62"></a>        )</span>
<span id="cb8-63"><a href="#cb8-63"></a>fig.savefig(<span class="st">"outliers_3sigma.png"</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/c3/7hp0d36n6vv8jc9hm2440__00000gn/T/ipykernel_73326/653833997.py:6: MatplotlibDeprecationWarning: Auto-removal of overlapping axes is deprecated since 3.6 and will be removed two minor releases later; explicitly call ax.remove() as needed.
  ax0 = plt.subplot(gs[0, 0])</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="outliers_graphs_files/figure-html/cell-9-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="iqr" class="level2" data-number="59.6">
<h2 data-number="59.6" class="anchored" data-anchor-id="iqr"><span class="header-section-number">59.6</span> IQR</h2>
<div class="cell" data-execution_count="9">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1"></a><span class="co"># get kdeplot data</span></span>
<span id="cb10-2"><a href="#cb10-2"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>))</span>
<span id="cb10-3"><a href="#cb10-3"></a>my_kde <span class="op">=</span> sns.kdeplot(df[<span class="st">'signal'</span>], bw_adjust<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb10-4"><a href="#cb10-4"></a>line <span class="op">=</span> my_kde.lines[<span class="dv">0</span>]</span>
<span id="cb10-5"><a href="#cb10-5"></a>kde_vals, kde_pdf <span class="op">=</span> line.get_data()</span>
<span id="cb10-6"><a href="#cb10-6"></a>kde_cdf <span class="op">=</span> np.cumsum(kde_pdf) <span class="op">/</span> np.<span class="bu">sum</span>(kde_pdf)</span>
<span id="cb10-7"><a href="#cb10-7"></a></span>
<span id="cb10-8"><a href="#cb10-8"></a><span class="kw">def</span> find_nearest(array, value):</span>
<span id="cb10-9"><a href="#cb10-9"></a>    <span class="cf">return</span> (np.<span class="bu">abs</span>(array <span class="op">-</span> value)).argmin()</span>
<span id="cb10-10"><a href="#cb10-10"></a></span>
<span id="cb10-11"><a href="#cb10-11"></a><span class="co"># Find the boundaries where the KDE is 25% and 75% of the area</span></span>
<span id="cb10-12"><a href="#cb10-12"></a>Q1_index <span class="op">=</span> find_nearest(kde_cdf, <span class="fl">0.25</span>)</span>
<span id="cb10-13"><a href="#cb10-13"></a>Q1_boundary <span class="op">=</span> kde_vals[Q1_index]</span>
<span id="cb10-14"><a href="#cb10-14"></a>Q3_index <span class="op">=</span> find_nearest(kde_cdf, <span class="fl">0.75</span>)</span>
<span id="cb10-15"><a href="#cb10-15"></a>Q3_boundary <span class="op">=</span> kde_vals[Q3_index]</span>
<span id="cb10-16"><a href="#cb10-16"></a>IQR <span class="op">=</span> Q3_boundary <span class="op">-</span> Q1_boundary</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="outliers_graphs_files/figure-html/cell-10-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="10">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>))</span>
<span id="cb11-2"><a href="#cb11-2"></a></span>
<span id="cb11-3"><a href="#cb11-3"></a>sns.kdeplot(df[<span class="st">'signal'</span>], ax<span class="op">=</span>ax, shade<span class="op">=</span><span class="va">True</span>, bw_adjust<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb11-4"><a href="#cb11-4"></a></span>
<span id="cb11-5"><a href="#cb11-5"></a>ax.fill_between(x<span class="op">=</span>kde_vals[Q1_index:Q3_index],</span>
<span id="cb11-6"><a href="#cb11-6"></a>                y1<span class="op">=</span>kde_pdf[Q1_index:Q3_index],</span>
<span id="cb11-7"><a href="#cb11-7"></a>                color<span class="op">=</span><span class="st">"tab:pink"</span></span>
<span id="cb11-8"><a href="#cb11-8"></a>                )</span>
<span id="cb11-9"><a href="#cb11-9"></a></span>
<span id="cb11-10"><a href="#cb11-10"></a>h <span class="op">=</span> <span class="fl">0.02</span></span>
<span id="cb11-11"><a href="#cb11-11"></a>ax.annotate(<span class="st">""</span>,</span>
<span id="cb11-12"><a href="#cb11-12"></a>            xy<span class="op">=</span>(Q1_boundary, h), xycoords<span class="op">=</span><span class="st">'data'</span>,</span>
<span id="cb11-13"><a href="#cb11-13"></a>            xytext<span class="op">=</span>(Q3_boundary, h), textcoords<span class="op">=</span><span class="st">'data'</span>,</span>
<span id="cb11-14"><a href="#cb11-14"></a>            size<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb11-15"><a href="#cb11-15"></a>            arrowprops<span class="op">=</span><span class="bu">dict</span>(arrowstyle<span class="op">=</span><span class="st">"&lt;-&gt;"</span>,</span>
<span id="cb11-16"><a href="#cb11-16"></a>                            connectionstyle<span class="op">=</span><span class="st">"arc3,rad=0.0"</span>,</span>
<span id="cb11-17"><a href="#cb11-17"></a>                            shrinkA<span class="op">=</span><span class="dv">0</span>, shrinkB<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb11-18"><a href="#cb11-18"></a>                            linewidth<span class="op">=</span><span class="fl">2.5</span></span>
<span id="cb11-19"><a href="#cb11-19"></a>                            ),</span>
<span id="cb11-20"><a href="#cb11-20"></a>            )</span>
<span id="cb11-21"><a href="#cb11-21"></a>ax.annotate(<span class="st">""</span>,</span>
<span id="cb11-22"><a href="#cb11-22"></a>            xy<span class="op">=</span>(Q1_boundary, h), xycoords<span class="op">=</span><span class="st">'data'</span>,</span>
<span id="cb11-23"><a href="#cb11-23"></a>            xytext<span class="op">=</span>(Q3_boundary, h), textcoords<span class="op">=</span><span class="st">'data'</span>,</span>
<span id="cb11-24"><a href="#cb11-24"></a>            size<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb11-25"><a href="#cb11-25"></a>            arrowprops<span class="op">=</span><span class="bu">dict</span>(arrowstyle<span class="op">=</span><span class="st">"&lt;-&gt;"</span>,</span>
<span id="cb11-26"><a href="#cb11-26"></a>                            connectionstyle<span class="op">=</span><span class="st">"arc3,rad=0.0"</span>,</span>
<span id="cb11-27"><a href="#cb11-27"></a>                            shrinkA<span class="op">=</span><span class="dv">0</span>, shrinkB<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb11-28"><a href="#cb11-28"></a>                            linewidth<span class="op">=</span><span class="fl">2.5</span></span>
<span id="cb11-29"><a href="#cb11-29"></a>                            ),</span>
<span id="cb11-30"><a href="#cb11-30"></a>            )</span>
<span id="cb11-31"><a href="#cb11-31"></a></span>
<span id="cb11-32"><a href="#cb11-32"></a>ax.annotate(<span class="st">"Q1</span><span class="ch">\n</span><span class="st">quantile 0.25"</span>,</span>
<span id="cb11-33"><a href="#cb11-33"></a>            xy<span class="op">=</span>(Q1_boundary, <span class="fl">0.025</span>), xycoords<span class="op">=</span><span class="st">'data'</span>,</span>
<span id="cb11-34"><a href="#cb11-34"></a>            xytext<span class="op">=</span>(Q1_boundary<span class="op">-</span>IQR, <span class="fl">0.040</span>), textcoords<span class="op">=</span><span class="st">'data'</span>,</span>
<span id="cb11-35"><a href="#cb11-35"></a>            size<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb11-36"><a href="#cb11-36"></a>            ha<span class="op">=</span><span class="st">"right"</span>,</span>
<span id="cb11-37"><a href="#cb11-37"></a>            va<span class="op">=</span><span class="st">"top"</span>,</span>
<span id="cb11-38"><a href="#cb11-38"></a>            arrowprops<span class="op">=</span><span class="bu">dict</span>(arrowstyle<span class="op">=</span><span class="st">"-&gt;"</span>,</span>
<span id="cb11-39"><a href="#cb11-39"></a>                            connectionstyle<span class="op">=</span><span class="st">"angle,angleA=0,angleB=90,rad=5"</span>,</span>
<span id="cb11-40"><a href="#cb11-40"></a>                            shrinkA<span class="op">=</span><span class="dv">0</span>, shrinkB<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb11-41"><a href="#cb11-41"></a>                            linewidth<span class="op">=</span><span class="fl">2.5</span>,</span>
<span id="cb11-42"><a href="#cb11-42"></a>                            color<span class="op">=</span><span class="st">"black"</span></span>
<span id="cb11-43"><a href="#cb11-43"></a>                            ),</span>
<span id="cb11-44"><a href="#cb11-44"></a>            )</span>
<span id="cb11-45"><a href="#cb11-45"></a></span>
<span id="cb11-46"><a href="#cb11-46"></a>ax.annotate(<span class="st">"Q3</span><span class="ch">\n</span><span class="st">quantile 0.75"</span>,</span>
<span id="cb11-47"><a href="#cb11-47"></a>            xy<span class="op">=</span>(Q3_boundary, <span class="fl">0.025</span>), xycoords<span class="op">=</span><span class="st">'data'</span>,</span>
<span id="cb11-48"><a href="#cb11-48"></a>            xytext<span class="op">=</span>(Q3_boundary<span class="op">+</span>IQR, <span class="fl">0.040</span>), textcoords<span class="op">=</span><span class="st">'data'</span>,</span>
<span id="cb11-49"><a href="#cb11-49"></a>            size<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb11-50"><a href="#cb11-50"></a>            ha<span class="op">=</span><span class="st">"left"</span>,</span>
<span id="cb11-51"><a href="#cb11-51"></a>            va<span class="op">=</span><span class="st">"top"</span>,</span>
<span id="cb11-52"><a href="#cb11-52"></a>            arrowprops<span class="op">=</span><span class="bu">dict</span>(arrowstyle<span class="op">=</span><span class="st">"-&gt;"</span>,</span>
<span id="cb11-53"><a href="#cb11-53"></a>                            connectionstyle<span class="op">=</span><span class="st">"angle,angleA=0,angleB=90,rad=5"</span>,</span>
<span id="cb11-54"><a href="#cb11-54"></a>                            shrinkA<span class="op">=</span><span class="dv">0</span>, shrinkB<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb11-55"><a href="#cb11-55"></a>                            linewidth<span class="op">=</span><span class="fl">2.5</span>,</span>
<span id="cb11-56"><a href="#cb11-56"></a>                            color<span class="op">=</span><span class="st">"black"</span></span>
<span id="cb11-57"><a href="#cb11-57"></a>                            ),</span>
<span id="cb11-58"><a href="#cb11-58"></a>            )</span>
<span id="cb11-59"><a href="#cb11-59"></a></span>
<span id="cb11-60"><a href="#cb11-60"></a>ax.annotate(<span class="vs">r"Q3 + 1.5$\cdot$IQR"</span>,</span>
<span id="cb11-61"><a href="#cb11-61"></a>            xy<span class="op">=</span>(Q3_boundary<span class="op">+</span><span class="fl">1.5</span><span class="op">*</span>IQR, <span class="fl">0.00</span>), xycoords<span class="op">=</span><span class="st">'data'</span>,</span>
<span id="cb11-62"><a href="#cb11-62"></a>            xytext<span class="op">=</span>(Q3_boundary<span class="op">+</span><span class="fl">1.5</span><span class="op">*</span>IQR, <span class="fl">0.015</span>), textcoords<span class="op">=</span><span class="st">'data'</span>,</span>
<span id="cb11-63"><a href="#cb11-63"></a>            size<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb11-64"><a href="#cb11-64"></a>            ha<span class="op">=</span><span class="st">"left"</span>,</span>
<span id="cb11-65"><a href="#cb11-65"></a>            arrowprops<span class="op">=</span><span class="bu">dict</span>(arrowstyle<span class="op">=</span><span class="st">"-&gt;"</span>,</span>
<span id="cb11-66"><a href="#cb11-66"></a>                            connectionstyle<span class="op">=</span><span class="st">"angle,angleA=0,angleB=90,rad=5"</span>,</span>
<span id="cb11-67"><a href="#cb11-67"></a>                            shrinkA<span class="op">=</span><span class="dv">0</span>, shrinkB<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb11-68"><a href="#cb11-68"></a>                            linewidth<span class="op">=</span><span class="fl">2.5</span>,</span>
<span id="cb11-69"><a href="#cb11-69"></a>                            color<span class="op">=</span><span class="st">"black"</span></span>
<span id="cb11-70"><a href="#cb11-70"></a>                            ),</span>
<span id="cb11-71"><a href="#cb11-71"></a>            )</span>
<span id="cb11-72"><a href="#cb11-72"></a></span>
<span id="cb11-73"><a href="#cb11-73"></a>ax.annotate(<span class="vs">r"Q1 - 1.5$\cdot$IQR"</span>,</span>
<span id="cb11-74"><a href="#cb11-74"></a>            xy<span class="op">=</span>(Q1_boundary<span class="op">-</span><span class="fl">1.5</span><span class="op">*</span>IQR, <span class="fl">0.00</span>), xycoords<span class="op">=</span><span class="st">'data'</span>,</span>
<span id="cb11-75"><a href="#cb11-75"></a>            xytext<span class="op">=</span>(Q1_boundary<span class="op">-</span><span class="fl">1.5</span><span class="op">*</span>IQR, <span class="fl">0.015</span>), textcoords<span class="op">=</span><span class="st">'data'</span>,</span>
<span id="cb11-76"><a href="#cb11-76"></a>            size<span class="op">=</span><span class="dv">20</span>,</span>
<span id="cb11-77"><a href="#cb11-77"></a>            ha<span class="op">=</span><span class="st">"right"</span>,</span>
<span id="cb11-78"><a href="#cb11-78"></a>            arrowprops<span class="op">=</span><span class="bu">dict</span>(arrowstyle<span class="op">=</span><span class="st">"-&gt;"</span>,</span>
<span id="cb11-79"><a href="#cb11-79"></a>                            connectionstyle<span class="op">=</span><span class="st">"angle,angleA=0,angleB=90,rad=5"</span>,</span>
<span id="cb11-80"><a href="#cb11-80"></a>                            shrinkA<span class="op">=</span><span class="dv">0</span>, shrinkB<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb11-81"><a href="#cb11-81"></a>                            linewidth<span class="op">=</span><span class="fl">2.5</span>,</span>
<span id="cb11-82"><a href="#cb11-82"></a>                            color<span class="op">=</span><span class="st">"black"</span></span>
<span id="cb11-83"><a href="#cb11-83"></a>                            ),</span>
<span id="cb11-84"><a href="#cb11-84"></a>            )</span>
<span id="cb11-85"><a href="#cb11-85"></a></span>
<span id="cb11-86"><a href="#cb11-86"></a>ax.text(Q1_boundary<span class="op">+</span>IQR<span class="op">/</span><span class="dv">2</span>, <span class="fl">0.018</span>, <span class="st">"IQR"</span>,</span>
<span id="cb11-87"><a href="#cb11-87"></a>        ha<span class="op">=</span><span class="st">"center"</span>, va<span class="op">=</span><span class="st">"top"</span>, color<span class="op">=</span><span class="st">"white"</span>)</span>
<span id="cb11-88"><a href="#cb11-88"></a>ax.text(Q1_boundary<span class="op">+</span>IQR<span class="op">/</span><span class="dv">2</span>, <span class="fl">0.013</span>, <span class="vs">r"50</span><span class="sc">% o</span><span class="vs">f"</span><span class="op">+</span><span class="st">"</span><span class="ch">\n</span><span class="st">the area"</span>,</span>
<span id="cb11-89"><a href="#cb11-89"></a>        ha<span class="op">=</span><span class="st">"center"</span>, va<span class="op">=</span><span class="st">"top"</span>, color<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb11-90"><a href="#cb11-90"></a></span>
<span id="cb11-91"><a href="#cb11-91"></a>ax.<span class="bu">set</span>(xlim<span class="op">=</span>[Q1_boundary<span class="op">-</span><span class="dv">5</span><span class="op">*</span>IQR, Q3_boundary<span class="op">+</span><span class="dv">5</span><span class="op">*</span>IQR],</span>
<span id="cb11-92"><a href="#cb11-92"></a>       ylabel<span class="op">=</span><span class="st">"pdf"</span>,)</span>
<span id="cb11-93"><a href="#cb11-93"></a>fig.savefig(<span class="st">"IQR_pdf.png"</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="outliers_graphs_files/figure-html/cell-11-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="11">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>))</span>
<span id="cb12-2"><a href="#cb12-2"></a>gs <span class="op">=</span> gridspec.GridSpec(<span class="dv">1</span>, <span class="dv">2</span>, width_ratios<span class="op">=</span>[<span class="dv">1</span>, <span class="fl">0.2</span>], height_ratios<span class="op">=</span>[<span class="dv">1</span>])</span>
<span id="cb12-3"><a href="#cb12-3"></a>gs.update(left<span class="op">=</span><span class="fl">0.10</span>, right<span class="op">=</span><span class="fl">0.90</span>, top<span class="op">=</span><span class="fl">0.95</span>, bottom<span class="op">=</span><span class="fl">0.13</span>,</span>
<span id="cb12-4"><a href="#cb12-4"></a>          hspace<span class="op">=</span><span class="fl">0.02</span>, wspace<span class="op">=</span><span class="fl">0.02</span>)</span>
<span id="cb12-5"><a href="#cb12-5"></a></span>
<span id="cb12-6"><a href="#cb12-6"></a>ax0 <span class="op">=</span> plt.subplot(gs[<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb12-7"><a href="#cb12-7"></a>ax1 <span class="op">=</span> plt.subplot(gs[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb12-8"><a href="#cb12-8"></a></span>
<span id="cb12-9"><a href="#cb12-9"></a>median <span class="op">=</span> df[<span class="st">'signal'</span>].quantile(<span class="fl">0.50</span>)</span>
<span id="cb12-10"><a href="#cb12-10"></a>Q1 <span class="op">=</span> df[<span class="st">'signal'</span>].quantile(<span class="fl">0.25</span>)</span>
<span id="cb12-11"><a href="#cb12-11"></a>Q3 <span class="op">=</span> df[<span class="st">'signal'</span>].quantile(<span class="fl">0.75</span>)</span>
<span id="cb12-12"><a href="#cb12-12"></a>IQR <span class="op">=</span> Q3 <span class="op">-</span> Q1</span>
<span id="cb12-13"><a href="#cb12-13"></a></span>
<span id="cb12-14"><a href="#cb12-14"></a><span class="co"># plot signal</span></span>
<span id="cb12-15"><a href="#cb12-15"></a>ax0.plot(df[<span class="st">'signal'</span>], color<span class="op">=</span><span class="st">"tab:blue"</span>)</span>
<span id="cb12-16"><a href="#cb12-16"></a></span>
<span id="cb12-17"><a href="#cb12-17"></a>my_kde <span class="op">=</span> sns.kdeplot(data<span class="op">=</span>df, y<span class="op">=</span><span class="st">'signal'</span>, shade<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax1, bw_adjust<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb12-18"><a href="#cb12-18"></a>pdf_xlim <span class="op">=</span>ax1.get_xlim()</span>
<span id="cb12-19"><a href="#cb12-19"></a></span>
<span id="cb12-20"><a href="#cb12-20"></a>kde_q1_idx <span class="op">=</span> find_nearest(kde_vals, Q1)</span>
<span id="cb12-21"><a href="#cb12-21"></a>kde_q3_idx <span class="op">=</span> find_nearest(kde_vals, Q3)</span>
<span id="cb12-22"><a href="#cb12-22"></a>ax1.fill_betweenx(y<span class="op">=</span>kde_vals[kde_q1_idx:kde_q3_idx],</span>
<span id="cb12-23"><a href="#cb12-23"></a>                  x1<span class="op">=</span>kde_pdf[kde_q1_idx:kde_q3_idx],</span>
<span id="cb12-24"><a href="#cb12-24"></a>                  color<span class="op">=</span><span class="st">"tab:pink"</span>)</span>
<span id="cb12-25"><a href="#cb12-25"></a><span class="co"># plot horizontal lines</span></span>
<span id="cb12-26"><a href="#cb12-26"></a><span class="co"># Q3 + 1.5 IQR</span></span>
<span id="cb12-27"><a href="#cb12-27"></a>ax0.plot([start, end], [Q3<span class="op">+</span><span class="fl">1.5</span><span class="op">*</span>IQR]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb12-28"><a href="#cb12-28"></a>ax1.plot(pdf_xlim, [Q3<span class="op">+</span><span class="fl">1.5</span><span class="op">*</span>IQR]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb12-29"><a href="#cb12-29"></a>ax1.text(<span class="fl">1.1</span><span class="op">*</span>pdf_xlim[<span class="dv">1</span>], Q3<span class="op">+</span><span class="fl">1.5</span><span class="op">*</span>IQR, <span class="st">"Q3+1.5*IQR"</span>, va<span class="op">=</span><span class="st">"center"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb12-30"><a href="#cb12-30"></a><span class="co"># Q1 - 1.5 IQR</span></span>
<span id="cb12-31"><a href="#cb12-31"></a>ax0.plot([start, end], [Q1<span class="op">-</span><span class="fl">1.5</span><span class="op">*</span>IQR]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb12-32"><a href="#cb12-32"></a>ax1.plot(pdf_xlim, [Q1<span class="op">-</span><span class="fl">1.5</span><span class="op">*</span>IQR]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb12-33"><a href="#cb12-33"></a>ax1.text(<span class="fl">1.1</span><span class="op">*</span>pdf_xlim[<span class="dv">1</span>], Q1<span class="op">-</span><span class="fl">1.5</span><span class="op">*</span>IQR, <span class="st">"Q1-1.5*IQR"</span>, va<span class="op">=</span><span class="st">"center"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb12-34"><a href="#cb12-34"></a></span>
<span id="cb12-35"><a href="#cb12-35"></a><span class="co"># find and plot outliers</span></span>
<span id="cb12-36"><a href="#cb12-36"></a>outliers_index <span class="op">=</span> df.index[(df[<span class="st">'signal'</span>] <span class="op">&gt;</span> Q3<span class="op">+</span><span class="fl">1.5</span><span class="op">*</span>IQR) <span class="op">|</span> </span>
<span id="cb12-37"><a href="#cb12-37"></a>                          (df[<span class="st">'signal'</span>] <span class="op">&lt;</span> Q1<span class="op">-</span><span class="fl">1.5</span><span class="op">*</span>IQR)</span>
<span id="cb12-38"><a href="#cb12-38"></a>                         ]</span>
<span id="cb12-39"><a href="#cb12-39"></a>ax0.plot(df.loc[outliers_index, <span class="st">'signal'</span>], ls<span class="op">=</span><span class="st">'None'</span>,</span>
<span id="cb12-40"><a href="#cb12-40"></a>        marker<span class="op">=</span><span class="st">'o'</span>, markerfacecolor<span class="op">=</span><span class="st">'yellow'</span>, markersize<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb12-41"><a href="#cb12-41"></a>        markeredgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb12-42"><a href="#cb12-42"></a><span class="co"># make graph look nice</span></span>
<span id="cb12-43"><a href="#cb12-43"></a>ax0.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">'values'</span>,</span>
<span id="cb12-44"><a href="#cb12-44"></a>       xlim<span class="op">=</span>[start,end],</span>
<span id="cb12-45"><a href="#cb12-45"></a>       ylim<span class="op">=</span>[<span class="op">-</span><span class="dv">45</span>, <span class="dv">80</span>],</span>
<span id="cb12-46"><a href="#cb12-46"></a>       title<span class="op">=</span><span class="vs">r"threshold: Q$\pm1.5$ IQR"</span>,</span>
<span id="cb12-47"><a href="#cb12-47"></a>       )</span>
<span id="cb12-48"><a href="#cb12-48"></a>concise(ax0)</span>
<span id="cb12-49"><a href="#cb12-49"></a>ax1.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'pdf'</span>,</span>
<span id="cb12-50"><a href="#cb12-50"></a>        ylabel<span class="op">=</span><span class="st">''</span>,</span>
<span id="cb12-51"><a href="#cb12-51"></a>        ylim<span class="op">=</span>[<span class="op">-</span><span class="dv">45</span>, <span class="dv">80</span>],</span>
<span id="cb12-52"><a href="#cb12-52"></a>        yticks<span class="op">=</span>[],</span>
<span id="cb12-53"><a href="#cb12-53"></a>        xticks<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">0.03</span>],</span>
<span id="cb12-54"><a href="#cb12-54"></a>        xticklabels<span class="op">=</span>[<span class="st">'0'</span>, <span class="st">'0.03'</span>]</span>
<span id="cb12-55"><a href="#cb12-55"></a>        )</span>
<span id="cb12-56"><a href="#cb12-56"></a>fig.savefig(<span class="st">"outliers_1.5IQR.png"</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/c3/7hp0d36n6vv8jc9hm2440__00000gn/T/ipykernel_73326/3077230861.py:6: MatplotlibDeprecationWarning: Auto-removal of overlapping axes is deprecated since 3.6 and will be removed two minor releases later; explicitly call ax.remove() as needed.
  ax0 = plt.subplot(gs[0, 0])</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="outliers_graphs_files/figure-html/cell-12-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="non-stationary-signal" class="level2" data-number="59.7">
<h2 data-number="59.7" class="anchored" data-anchor-id="non-stationary-signal"><span class="header-section-number">59.7</span> non stationary signal</h2>
<div class="cell" data-execution_count="12">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb14-1"><a href="#cb14-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>))</span>
<span id="cb14-2"><a href="#cb14-2"></a><span class="co"># plot signal</span></span>
<span id="cb14-3"><a href="#cb14-3"></a>ax.plot(df[<span class="st">'signal40'</span>], color<span class="op">=</span><span class="st">"tab:blue"</span>)</span>
<span id="cb14-4"><a href="#cb14-4"></a><span class="co"># make graph look nice</span></span>
<span id="cb14-5"><a href="#cb14-5"></a>ax.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">'values'</span>,</span>
<span id="cb14-6"><a href="#cb14-6"></a>       xlim<span class="op">=</span>[start,end],</span>
<span id="cb14-7"><a href="#cb14-7"></a>       title<span class="op">=</span><span class="st">"a non-stationary signal"</span>,</span>
<span id="cb14-8"><a href="#cb14-8"></a>       ylim<span class="op">=</span>[<span class="op">-</span><span class="dv">45</span>, <span class="dv">80</span>])</span>
<span id="cb14-9"><a href="#cb14-9"></a>concise(ax)</span>
<span id="cb14-10"><a href="#cb14-10"></a>fig.savefig(<span class="st">"signal_40_non_stationary.png"</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="outliers_graphs_files/figure-html/cell-13-output-1.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="running---3-std" class="level2" data-number="59.8">
<h2 data-number="59.8" class="anchored" data-anchor-id="running---3-std"><span class="header-section-number">59.8</span> running +- 3 std</h2>
<div class="cell" data-execution_count="13">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>))</span>
<span id="cb15-2"><a href="#cb15-2"></a>gs <span class="op">=</span> gridspec.GridSpec(<span class="dv">1</span>, <span class="dv">2</span>, width_ratios<span class="op">=</span>[<span class="dv">1</span>, <span class="fl">0.2</span>], height_ratios<span class="op">=</span>[<span class="dv">1</span>])</span>
<span id="cb15-3"><a href="#cb15-3"></a>gs.update(left<span class="op">=</span><span class="fl">0.10</span>, right<span class="op">=</span><span class="fl">0.90</span>, top<span class="op">=</span><span class="fl">0.95</span>, bottom<span class="op">=</span><span class="fl">0.13</span>,</span>
<span id="cb15-4"><a href="#cb15-4"></a>          hspace<span class="op">=</span><span class="fl">0.02</span>, wspace<span class="op">=</span><span class="fl">0.02</span>)</span>
<span id="cb15-5"><a href="#cb15-5"></a></span>
<span id="cb15-6"><a href="#cb15-6"></a>ax0 <span class="op">=</span> plt.subplot(gs[<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb15-7"><a href="#cb15-7"></a>ax1 <span class="op">=</span> plt.subplot(gs[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb15-8"><a href="#cb15-8"></a></span>
<span id="cb15-9"><a href="#cb15-9"></a>avg <span class="op">=</span> df[<span class="st">'signal40'</span>].mean()</span>
<span id="cb15-10"><a href="#cb15-10"></a>std <span class="op">=</span> df[<span class="st">'signal40'</span>].std()</span>
<span id="cb15-11"><a href="#cb15-11"></a></span>
<span id="cb15-12"><a href="#cb15-12"></a><span class="co"># plot signal</span></span>
<span id="cb15-13"><a href="#cb15-13"></a>ax0.plot(df[<span class="st">'signal40'</span>], color<span class="op">=</span><span class="st">"tab:blue"</span>)</span>
<span id="cb15-14"><a href="#cb15-14"></a></span>
<span id="cb15-15"><a href="#cb15-15"></a>sns.kdeplot(data<span class="op">=</span>df, y<span class="op">=</span><span class="st">'signal40'</span>, shade<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb15-16"><a href="#cb15-16"></a></span>
<span id="cb15-17"><a href="#cb15-17"></a></span>
<span id="cb15-18"><a href="#cb15-18"></a><span class="co"># plot horizontal lines</span></span>
<span id="cb15-19"><a href="#cb15-19"></a><span class="co"># mean</span></span>
<span id="cb15-20"><a href="#cb15-20"></a>ax0.plot([start, end], [avg]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, zorder<span class="op">=-</span><span class="dv">10</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb15-21"><a href="#cb15-21"></a>ax1.plot(pdf_xlim, [avg]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.7</span>)</span>
<span id="cb15-22"><a href="#cb15-22"></a>ax1.text(<span class="fl">1.1</span><span class="op">*</span>pdf_xlim[<span class="dv">1</span>], avg, <span class="st">"mean"</span>, va<span class="op">=</span><span class="st">"center"</span>)</span>
<span id="cb15-23"><a href="#cb15-23"></a><span class="co"># mean + std</span></span>
<span id="cb15-24"><a href="#cb15-24"></a>ax0.plot([start, end], [avg<span class="op">+</span>std]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb15-25"><a href="#cb15-25"></a>ax1.plot(pdf_xlim, [avg<span class="op">+</span>std]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb15-26"><a href="#cb15-26"></a>ax1.text(<span class="fl">1.1</span><span class="op">*</span>pdf_xlim[<span class="dv">1</span>], avg<span class="op">+</span>std, <span class="st">"mean+std"</span>, va<span class="op">=</span><span class="st">"center"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb15-27"><a href="#cb15-27"></a><span class="co"># mean - std</span></span>
<span id="cb15-28"><a href="#cb15-28"></a>ax0.plot([start, end], [avg<span class="op">-</span>std]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb15-29"><a href="#cb15-29"></a>ax1.plot(pdf_xlim, [avg<span class="op">-</span>std]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb15-30"><a href="#cb15-30"></a>ax1.text(<span class="fl">1.1</span><span class="op">*</span>pdf_xlim[<span class="dv">1</span>], avg<span class="op">-</span>std, <span class="st">"mean-std"</span>, va<span class="op">=</span><span class="st">"center"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb15-31"><a href="#cb15-31"></a></span>
<span id="cb15-32"><a href="#cb15-32"></a>n_sigma <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb15-33"><a href="#cb15-33"></a><span class="co"># mean + 3std</span></span>
<span id="cb15-34"><a href="#cb15-34"></a>ax0.plot([start, end], [avg<span class="op">+</span>n_sigma<span class="op">*</span>std]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"tab:red"</span>)</span>
<span id="cb15-35"><a href="#cb15-35"></a>ax1.plot(pdf_xlim, [avg<span class="op">+</span>n_sigma<span class="op">*</span>std]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"tab:red"</span>)</span>
<span id="cb15-36"><a href="#cb15-36"></a>ax1.text(<span class="fl">1.1</span><span class="op">*</span>pdf_xlim[<span class="dv">1</span>], avg<span class="op">+</span>n_sigma<span class="op">*</span>std, <span class="vs">r"mean $+3\times$std"</span>, va<span class="op">=</span><span class="st">"center"</span>, color<span class="op">=</span><span class="st">"tab:red"</span>)</span>
<span id="cb15-37"><a href="#cb15-37"></a><span class="co"># mean - 3std</span></span>
<span id="cb15-38"><a href="#cb15-38"></a>ax0.plot([start, end], [avg<span class="op">-</span>n_sigma<span class="op">*</span>std]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"tab:red"</span>)</span>
<span id="cb15-39"><a href="#cb15-39"></a>ax1.plot(pdf_xlim, [avg<span class="op">-</span>n_sigma<span class="op">*</span>std]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"tab:red"</span>)</span>
<span id="cb15-40"><a href="#cb15-40"></a>ax1.text(<span class="fl">1.1</span><span class="op">*</span>pdf_xlim[<span class="dv">1</span>], avg<span class="op">-</span>n_sigma<span class="op">*</span>std, <span class="vs">r"mean $-3\times$std"</span>, va<span class="op">=</span><span class="st">"center"</span>, color<span class="op">=</span><span class="st">"tab:red"</span>)</span>
<span id="cb15-41"><a href="#cb15-41"></a></span>
<span id="cb15-42"><a href="#cb15-42"></a><span class="co"># find and plot outliers</span></span>
<span id="cb15-43"><a href="#cb15-43"></a>outliers_index <span class="op">=</span> df.index[(df[<span class="st">'signal40'</span>] <span class="op">&gt;</span> avg <span class="op">+</span> n_sigma<span class="op">*</span>std) <span class="op">|</span> </span>
<span id="cb15-44"><a href="#cb15-44"></a>                          (df[<span class="st">'signal40'</span>] <span class="op">&lt;</span> avg <span class="op">-</span> n_sigma<span class="op">*</span>std)</span>
<span id="cb15-45"><a href="#cb15-45"></a>                         ]</span>
<span id="cb15-46"><a href="#cb15-46"></a>ax0.plot(df.loc[outliers_index, <span class="st">'signal40'</span>], ls<span class="op">=</span><span class="st">'None'</span>,</span>
<span id="cb15-47"><a href="#cb15-47"></a>        marker<span class="op">=</span><span class="st">'o'</span>, markerfacecolor<span class="op">=</span><span class="st">'yellow'</span>, markersize<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb15-48"><a href="#cb15-48"></a>        markeredgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb15-49"><a href="#cb15-49"></a><span class="co"># make graph look nice</span></span>
<span id="cb15-50"><a href="#cb15-50"></a>ax0.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">'values'</span>,</span>
<span id="cb15-51"><a href="#cb15-51"></a>       xlim<span class="op">=</span>[start,end],</span>
<span id="cb15-52"><a href="#cb15-52"></a>       ylim<span class="op">=</span>[<span class="op">-</span><span class="dv">45</span>, <span class="dv">120</span>],</span>
<span id="cb15-53"><a href="#cb15-53"></a>       title<span class="op">=</span><span class="vs">r"threshold: mean $\pm3$ std"</span>,</span>
<span id="cb15-54"><a href="#cb15-54"></a>       )</span>
<span id="cb15-55"><a href="#cb15-55"></a>concise(ax0)</span>
<span id="cb15-56"><a href="#cb15-56"></a>ax1.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'pdf'</span>,</span>
<span id="cb15-57"><a href="#cb15-57"></a>        ylabel<span class="op">=</span><span class="st">''</span>,</span>
<span id="cb15-58"><a href="#cb15-58"></a>        ylim<span class="op">=</span>[<span class="op">-</span><span class="dv">45</span>, <span class="dv">120</span>],</span>
<span id="cb15-59"><a href="#cb15-59"></a>        yticks<span class="op">=</span>[],</span>
<span id="cb15-60"><a href="#cb15-60"></a>        xticks<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">0.03</span>],</span>
<span id="cb15-61"><a href="#cb15-61"></a>        xticklabels<span class="op">=</span>[<span class="st">'0'</span>, <span class="st">'0.03'</span>]</span>
<span id="cb15-62"><a href="#cb15-62"></a>        )</span>
<span id="cb15-63"><a href="#cb15-63"></a>fig.savefig(<span class="st">"outliers_3sigma_seed40.png"</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/c3/7hp0d36n6vv8jc9hm2440__00000gn/T/ipykernel_73326/372016966.py:6: MatplotlibDeprecationWarning: Auto-removal of overlapping axes is deprecated since 3.6 and will be removed two minor releases later; explicitly call ax.remove() as needed.
  ax0 = plt.subplot(gs[0, 0])</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="outliers_graphs_files/figure-html/cell-14-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="14">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1"></a>df[<span class="st">'signal40_rol_mean'</span>] <span class="op">=</span> df[<span class="st">'signal40'</span>].rolling(<span class="st">'60min'</span>, center<span class="op">=</span><span class="va">True</span>).mean()</span>
<span id="cb17-2"><a href="#cb17-2"></a>df[<span class="st">'signal40_rol_std'</span>] <span class="op">=</span> df[<span class="st">'signal40'</span>].rolling(<span class="st">'60min'</span>, center<span class="op">=</span><span class="va">True</span>).std()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>))</span>
<span id="cb18-2"><a href="#cb18-2"></a>gs <span class="op">=</span> gridspec.GridSpec(<span class="dv">1</span>, <span class="dv">2</span>, width_ratios<span class="op">=</span>[<span class="dv">1</span>, <span class="fl">0.2</span>], height_ratios<span class="op">=</span>[<span class="dv">1</span>])</span>
<span id="cb18-3"><a href="#cb18-3"></a>gs.update(left<span class="op">=</span><span class="fl">0.10</span>, right<span class="op">=</span><span class="fl">0.90</span>, top<span class="op">=</span><span class="fl">0.95</span>, bottom<span class="op">=</span><span class="fl">0.13</span>,</span>
<span id="cb18-4"><a href="#cb18-4"></a>          hspace<span class="op">=</span><span class="fl">0.02</span>, wspace<span class="op">=</span><span class="fl">0.02</span>)</span>
<span id="cb18-5"><a href="#cb18-5"></a></span>
<span id="cb18-6"><a href="#cb18-6"></a>ax0 <span class="op">=</span> plt.subplot(gs[<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb18-7"><a href="#cb18-7"></a>ax1 <span class="op">=</span> plt.subplot(gs[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb18-8"><a href="#cb18-8"></a></span>
<span id="cb18-9"><a href="#cb18-9"></a>avg <span class="op">=</span> df[<span class="st">'signal40'</span>].mean()</span>
<span id="cb18-10"><a href="#cb18-10"></a>std <span class="op">=</span> df[<span class="st">'signal40'</span>].std()</span>
<span id="cb18-11"><a href="#cb18-11"></a></span>
<span id="cb18-12"><a href="#cb18-12"></a><span class="co"># plot signal</span></span>
<span id="cb18-13"><a href="#cb18-13"></a>ax0.plot(df[<span class="st">'signal40'</span>], color<span class="op">=</span><span class="st">"tab:blue"</span>)</span>
<span id="cb18-14"><a href="#cb18-14"></a></span>
<span id="cb18-15"><a href="#cb18-15"></a>sns.kdeplot(data<span class="op">=</span>df, y<span class="op">=</span><span class="st">'signal40'</span>, shade<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb18-16"><a href="#cb18-16"></a></span>
<span id="cb18-17"><a href="#cb18-17"></a><span class="co"># mean</span></span>
<span id="cb18-18"><a href="#cb18-18"></a>ax0.plot(df[<span class="st">'signal40_rol_mean'</span>], color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.7</span>, label<span class="op">=</span><span class="st">"mean"</span>)</span>
<span id="cb18-19"><a href="#cb18-19"></a><span class="co"># mean +- 3 std</span></span>
<span id="cb18-20"><a href="#cb18-20"></a>n_sigma <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb18-21"><a href="#cb18-21"></a>ax0.plot(df[<span class="st">'signal40_rol_mean'</span>]<span class="op">+</span> n_sigma<span class="op">*</span>df[<span class="st">'signal40_rol_std'</span>], color<span class="op">=</span><span class="st">"tab:red"</span>)</span>
<span id="cb18-22"><a href="#cb18-22"></a>plot_threshold, <span class="op">=</span> ax0.plot(df[<span class="st">'signal40_rol_mean'</span>]<span class="op">-</span> n_sigma<span class="op">*</span>df[<span class="st">'signal40_rol_std'</span>],</span>
<span id="cb18-23"><a href="#cb18-23"></a>                           color<span class="op">=</span><span class="st">"tab:red"</span>, label<span class="op">=</span><span class="st">"threshold"</span>)</span>
<span id="cb18-24"><a href="#cb18-24"></a></span>
<span id="cb18-25"><a href="#cb18-25"></a><span class="co"># find and plot outliers</span></span>
<span id="cb18-26"><a href="#cb18-26"></a>outliers_index <span class="op">=</span> df.index[(df[<span class="st">'signal40'</span>] <span class="op">&gt;</span> df[<span class="st">'signal40_rol_mean'</span>]<span class="op">+</span> n_sigma<span class="op">*</span>df[<span class="st">'signal40_rol_std'</span>]) <span class="op">|</span> </span>
<span id="cb18-27"><a href="#cb18-27"></a>                          (df[<span class="st">'signal40'</span>] <span class="op">&lt;</span> df[<span class="st">'signal40_rol_mean'</span>]<span class="op">-</span> n_sigma<span class="op">*</span>df[<span class="st">'signal40_rol_std'</span>])</span>
<span id="cb18-28"><a href="#cb18-28"></a>                         ]</span>
<span id="cb18-29"><a href="#cb18-29"></a>ax0.plot(df.loc[outliers_index, <span class="st">'signal40'</span>], ls<span class="op">=</span><span class="st">'None'</span>,</span>
<span id="cb18-30"><a href="#cb18-30"></a>        marker<span class="op">=</span><span class="st">'o'</span>, markerfacecolor<span class="op">=</span><span class="st">'yellow'</span>, markersize<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb18-31"><a href="#cb18-31"></a>        markeredgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb18-32"><a href="#cb18-32"></a><span class="co"># make graph look nice</span></span>
<span id="cb18-33"><a href="#cb18-33"></a>ax0.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">'values'</span>,</span>
<span id="cb18-34"><a href="#cb18-34"></a>       xlim<span class="op">=</span>[start,end],</span>
<span id="cb18-35"><a href="#cb18-35"></a>       ylim<span class="op">=</span>[<span class="op">-</span><span class="dv">45</span>, <span class="dv">120</span>],</span>
<span id="cb18-36"><a href="#cb18-36"></a>       title<span class="op">=</span><span class="vs">r"1-hour rolling window: mean $\pm3$ std"</span>,</span>
<span id="cb18-37"><a href="#cb18-37"></a>       )</span>
<span id="cb18-38"><a href="#cb18-38"></a>concise(ax0)</span>
<span id="cb18-39"><a href="#cb18-39"></a>ax1.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'pdf'</span>,</span>
<span id="cb18-40"><a href="#cb18-40"></a>        ylabel<span class="op">=</span><span class="st">''</span>,</span>
<span id="cb18-41"><a href="#cb18-41"></a>        ylim<span class="op">=</span>[<span class="op">-</span><span class="dv">45</span>, <span class="dv">120</span>],</span>
<span id="cb18-42"><a href="#cb18-42"></a>        yticks<span class="op">=</span>[],</span>
<span id="cb18-43"><a href="#cb18-43"></a>        xticks<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">0.03</span>],</span>
<span id="cb18-44"><a href="#cb18-44"></a>        xticklabels<span class="op">=</span>[<span class="st">'0'</span>, <span class="st">'0.03'</span>]</span>
<span id="cb18-45"><a href="#cb18-45"></a>        )</span>
<span id="cb18-46"><a href="#cb18-46"></a>ax0.legend(frameon<span class="op">=</span><span class="va">False</span>, loc<span class="op">=</span><span class="st">"upper left"</span>)</span>
<span id="cb18-47"><a href="#cb18-47"></a></span>
<span id="cb18-48"><a href="#cb18-48"></a>fig.savefig(<span class="st">"outliers_rolling_3std.png"</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/c3/7hp0d36n6vv8jc9hm2440__00000gn/T/ipykernel_73326/142534422.py:6: MatplotlibDeprecationWarning: Auto-removal of overlapping axes is deprecated since 3.6 and will be removed two minor releases later; explicitly call ax.remove() as needed.
  ax0 = plt.subplot(gs[0, 0])</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="outliers_graphs_files/figure-html/cell-16-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="running-q---iqr" class="level2" data-number="59.9">
<h2 data-number="59.9" class="anchored" data-anchor-id="running-q---iqr"><span class="header-section-number">59.9</span> running: Q +- IQR</h2>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>))</span>
<span id="cb20-2"><a href="#cb20-2"></a></span>
<span id="cb20-3"><a href="#cb20-3"></a>my_kde <span class="op">=</span> sns.kdeplot(df[<span class="st">'signal40'</span>], bw_adjust<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb20-4"><a href="#cb20-4"></a>line <span class="op">=</span> my_kde.lines[<span class="dv">0</span>]</span>
<span id="cb20-5"><a href="#cb20-5"></a>kde_vals, kde_pdf <span class="op">=</span> line.get_data()</span>
<span id="cb20-6"><a href="#cb20-6"></a>kde_cdf <span class="op">=</span> np.cumsum(kde_pdf) <span class="op">/</span> np.<span class="bu">sum</span>(kde_pdf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="outliers_graphs_files/figure-html/cell-17-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="17">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>))</span>
<span id="cb21-2"><a href="#cb21-2"></a>gs <span class="op">=</span> gridspec.GridSpec(<span class="dv">1</span>, <span class="dv">2</span>, width_ratios<span class="op">=</span>[<span class="dv">1</span>, <span class="fl">0.2</span>], height_ratios<span class="op">=</span>[<span class="dv">1</span>])</span>
<span id="cb21-3"><a href="#cb21-3"></a>gs.update(left<span class="op">=</span><span class="fl">0.10</span>, right<span class="op">=</span><span class="fl">0.90</span>, top<span class="op">=</span><span class="fl">0.95</span>, bottom<span class="op">=</span><span class="fl">0.13</span>,</span>
<span id="cb21-4"><a href="#cb21-4"></a>          hspace<span class="op">=</span><span class="fl">0.02</span>, wspace<span class="op">=</span><span class="fl">0.02</span>)</span>
<span id="cb21-5"><a href="#cb21-5"></a></span>
<span id="cb21-6"><a href="#cb21-6"></a>ax0 <span class="op">=</span> plt.subplot(gs[<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb21-7"><a href="#cb21-7"></a>ax1 <span class="op">=</span> plt.subplot(gs[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb21-8"><a href="#cb21-8"></a></span>
<span id="cb21-9"><a href="#cb21-9"></a>median <span class="op">=</span> df[<span class="st">'signal40'</span>].quantile(<span class="fl">0.50</span>)</span>
<span id="cb21-10"><a href="#cb21-10"></a>Q1 <span class="op">=</span> df[<span class="st">'signal40'</span>].quantile(<span class="fl">0.25</span>)</span>
<span id="cb21-11"><a href="#cb21-11"></a>Q3 <span class="op">=</span> df[<span class="st">'signal40'</span>].quantile(<span class="fl">0.75</span>)</span>
<span id="cb21-12"><a href="#cb21-12"></a>IQR <span class="op">=</span> Q3 <span class="op">-</span> Q1</span>
<span id="cb21-13"><a href="#cb21-13"></a></span>
<span id="cb21-14"><a href="#cb21-14"></a><span class="co"># plot signal</span></span>
<span id="cb21-15"><a href="#cb21-15"></a>ax0.plot(df[<span class="st">'signal40'</span>], color<span class="op">=</span><span class="st">"tab:blue"</span>)</span>
<span id="cb21-16"><a href="#cb21-16"></a></span>
<span id="cb21-17"><a href="#cb21-17"></a>my_kde <span class="op">=</span> sns.kdeplot(data<span class="op">=</span>df, y<span class="op">=</span><span class="st">'signal40'</span>, shade<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax1, bw_adjust<span class="op">=</span><span class="fl">0.5</span>)</span>
<span id="cb21-18"><a href="#cb21-18"></a>pdf_xlim <span class="op">=</span>ax1.get_xlim()</span>
<span id="cb21-19"><a href="#cb21-19"></a></span>
<span id="cb21-20"><a href="#cb21-20"></a>kde_q1_idx <span class="op">=</span> find_nearest(kde_vals, Q1)</span>
<span id="cb21-21"><a href="#cb21-21"></a>kde_q3_idx <span class="op">=</span> find_nearest(kde_vals, Q3)</span>
<span id="cb21-22"><a href="#cb21-22"></a>ax1.fill_betweenx(y<span class="op">=</span>kde_vals[kde_q1_idx:kde_q3_idx],</span>
<span id="cb21-23"><a href="#cb21-23"></a>                  x1<span class="op">=</span>kde_pdf[kde_q1_idx:kde_q3_idx],</span>
<span id="cb21-24"><a href="#cb21-24"></a>                  color<span class="op">=</span><span class="st">"tab:pink"</span>)</span>
<span id="cb21-25"><a href="#cb21-25"></a><span class="co"># plot horizontal lines</span></span>
<span id="cb21-26"><a href="#cb21-26"></a><span class="co"># Q3 + 1.5 IQR</span></span>
<span id="cb21-27"><a href="#cb21-27"></a>ax0.plot([start, end], [Q3<span class="op">+</span><span class="fl">1.5</span><span class="op">*</span>IQR]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb21-28"><a href="#cb21-28"></a>ax1.plot(pdf_xlim, [Q3<span class="op">+</span><span class="fl">1.5</span><span class="op">*</span>IQR]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb21-29"><a href="#cb21-29"></a>ax1.text(<span class="fl">1.1</span><span class="op">*</span>pdf_xlim[<span class="dv">1</span>], Q3<span class="op">+</span><span class="fl">1.5</span><span class="op">*</span>IQR, <span class="st">"Q3+1.5*IQR"</span>, va<span class="op">=</span><span class="st">"center"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb21-30"><a href="#cb21-30"></a><span class="co"># Q1 - 1.5 IQR</span></span>
<span id="cb21-31"><a href="#cb21-31"></a>ax0.plot([start, end], [Q1<span class="op">-</span><span class="fl">1.5</span><span class="op">*</span>IQR]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb21-32"><a href="#cb21-32"></a>ax1.plot(pdf_xlim, [Q1<span class="op">-</span><span class="fl">1.5</span><span class="op">*</span>IQR]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb21-33"><a href="#cb21-33"></a>ax1.text(<span class="fl">1.1</span><span class="op">*</span>pdf_xlim[<span class="dv">1</span>], Q1<span class="op">-</span><span class="fl">1.5</span><span class="op">*</span>IQR, <span class="st">"Q1-1.5*IQR"</span>, va<span class="op">=</span><span class="st">"center"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb21-34"><a href="#cb21-34"></a></span>
<span id="cb21-35"><a href="#cb21-35"></a><span class="co"># find and plot outliers</span></span>
<span id="cb21-36"><a href="#cb21-36"></a>outliers_index <span class="op">=</span> df.index[(df[<span class="st">'signal40'</span>] <span class="op">&gt;</span> Q3<span class="op">+</span><span class="fl">1.5</span><span class="op">*</span>IQR) <span class="op">|</span> </span>
<span id="cb21-37"><a href="#cb21-37"></a>                          (df[<span class="st">'signal40'</span>] <span class="op">&lt;</span> Q1<span class="op">-</span><span class="fl">1.5</span><span class="op">*</span>IQR)</span>
<span id="cb21-38"><a href="#cb21-38"></a>                         ]</span>
<span id="cb21-39"><a href="#cb21-39"></a>ax0.plot(df.loc[outliers_index, <span class="st">'signal40'</span>], ls<span class="op">=</span><span class="st">'None'</span>,</span>
<span id="cb21-40"><a href="#cb21-40"></a>        marker<span class="op">=</span><span class="st">'o'</span>, markerfacecolor<span class="op">=</span><span class="st">'yellow'</span>, markersize<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb21-41"><a href="#cb21-41"></a>        markeredgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb21-42"><a href="#cb21-42"></a><span class="co"># make graph look nice</span></span>
<span id="cb21-43"><a href="#cb21-43"></a>ax0.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">'values'</span>,</span>
<span id="cb21-44"><a href="#cb21-44"></a>       xlim<span class="op">=</span>[start,end],</span>
<span id="cb21-45"><a href="#cb21-45"></a>       ylim<span class="op">=</span>[<span class="op">-</span><span class="dv">50</span>, <span class="dv">140</span>],</span>
<span id="cb21-46"><a href="#cb21-46"></a>       title<span class="op">=</span><span class="vs">r"threshold: Q$\pm1.5$ IQR"</span>,</span>
<span id="cb21-47"><a href="#cb21-47"></a>       )</span>
<span id="cb21-48"><a href="#cb21-48"></a>concise(ax0)</span>
<span id="cb21-49"><a href="#cb21-49"></a>ax1.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'pdf'</span>,</span>
<span id="cb21-50"><a href="#cb21-50"></a>        ylabel<span class="op">=</span><span class="st">''</span>,</span>
<span id="cb21-51"><a href="#cb21-51"></a>        ylim<span class="op">=</span>[<span class="op">-</span><span class="dv">50</span>, <span class="dv">140</span>],</span>
<span id="cb21-52"><a href="#cb21-52"></a>        yticks<span class="op">=</span>[],</span>
<span id="cb21-53"><a href="#cb21-53"></a>        xticks<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">0.03</span>],</span>
<span id="cb21-54"><a href="#cb21-54"></a>        xticklabels<span class="op">=</span>[<span class="st">'0'</span>, <span class="st">'0.03'</span>]</span>
<span id="cb21-55"><a href="#cb21-55"></a>        )</span>
<span id="cb21-56"><a href="#cb21-56"></a>fig.savefig(<span class="st">"outliers_1.5IQR_seed40.png"</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/c3/7hp0d36n6vv8jc9hm2440__00000gn/T/ipykernel_73326/678430211.py:6: MatplotlibDeprecationWarning: Auto-removal of overlapping axes is deprecated since 3.6 and will be removed two minor releases later; explicitly call ax.remove() as needed.
  ax0 = plt.subplot(gs[0, 0])</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="outliers_graphs_files/figure-html/cell-18-output-2.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="18">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1"></a><span class="kw">def</span> Q1(window):</span>
<span id="cb23-2"><a href="#cb23-2"></a>    <span class="cf">return</span> window.quantile(<span class="fl">0.25</span>)</span>
<span id="cb23-3"><a href="#cb23-3"></a><span class="kw">def</span> Q3(window):</span>
<span id="cb23-4"><a href="#cb23-4"></a>    <span class="cf">return</span> window.quantile(<span class="fl">0.75</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="19">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1"></a>df[<span class="st">'signal40_rol_Q1'</span>] <span class="op">=</span> df[<span class="st">'signal40'</span>].rolling(<span class="st">'60min'</span>, center<span class="op">=</span><span class="va">True</span>).<span class="bu">apply</span>(Q1)</span>
<span id="cb24-2"><a href="#cb24-2"></a>df[<span class="st">'signal40_rol_Q3'</span>] <span class="op">=</span> df[<span class="st">'signal40'</span>].rolling(<span class="st">'60min'</span>, center<span class="op">=</span><span class="va">True</span>).<span class="bu">apply</span>(Q3)</span>
<span id="cb24-3"><a href="#cb24-3"></a>df[<span class="st">'signal40_rol_IQR'</span>] <span class="op">=</span> df[<span class="st">'signal40_rol_Q3'</span>] <span class="op">-</span> df[<span class="st">'signal40_rol_Q1'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="20">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>))</span>
<span id="cb25-2"><a href="#cb25-2"></a>gs <span class="op">=</span> gridspec.GridSpec(<span class="dv">1</span>, <span class="dv">2</span>, width_ratios<span class="op">=</span>[<span class="dv">1</span>, <span class="fl">0.2</span>], height_ratios<span class="op">=</span>[<span class="dv">1</span>])</span>
<span id="cb25-3"><a href="#cb25-3"></a>gs.update(left<span class="op">=</span><span class="fl">0.10</span>, right<span class="op">=</span><span class="fl">0.90</span>, top<span class="op">=</span><span class="fl">0.95</span>, bottom<span class="op">=</span><span class="fl">0.13</span>,</span>
<span id="cb25-4"><a href="#cb25-4"></a>          hspace<span class="op">=</span><span class="fl">0.02</span>, wspace<span class="op">=</span><span class="fl">0.02</span>)</span>
<span id="cb25-5"><a href="#cb25-5"></a></span>
<span id="cb25-6"><a href="#cb25-6"></a>ax0 <span class="op">=</span> plt.subplot(gs[<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb25-7"><a href="#cb25-7"></a>ax1 <span class="op">=</span> plt.subplot(gs[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb25-8"><a href="#cb25-8"></a></span>
<span id="cb25-9"><a href="#cb25-9"></a>avg <span class="op">=</span> df[<span class="st">'signal40'</span>].mean()</span>
<span id="cb25-10"><a href="#cb25-10"></a>std <span class="op">=</span> df[<span class="st">'signal40'</span>].std()</span>
<span id="cb25-11"><a href="#cb25-11"></a></span>
<span id="cb25-12"><a href="#cb25-12"></a><span class="co"># plot signal</span></span>
<span id="cb25-13"><a href="#cb25-13"></a>ax0.plot(df[<span class="st">'signal40'</span>], color<span class="op">=</span><span class="st">"tab:blue"</span>)</span>
<span id="cb25-14"><a href="#cb25-14"></a></span>
<span id="cb25-15"><a href="#cb25-15"></a>sns.kdeplot(data<span class="op">=</span>df, y<span class="op">=</span><span class="st">'signal40'</span>, shade<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb25-16"><a href="#cb25-16"></a></span>
<span id="cb25-17"><a href="#cb25-17"></a><span class="co"># median</span></span>
<span id="cb25-18"><a href="#cb25-18"></a><span class="co"># ax0.plot(df['signal40_rol_median'], color="black", alpha=0.7, label="median")</span></span>
<span id="cb25-19"><a href="#cb25-19"></a><span class="co"># Q1 - 1.5 IQR</span></span>
<span id="cb25-20"><a href="#cb25-20"></a>threshold_bottom <span class="op">=</span> df[<span class="st">'signal40_rol_Q1'</span>] <span class="op">-</span> <span class="fl">1.5</span><span class="op">*</span>df[<span class="st">'signal40_rol_IQR'</span>]</span>
<span id="cb25-21"><a href="#cb25-21"></a>ax0.plot(threshold_bottom, color<span class="op">=</span><span class="st">"tab:red"</span>)</span>
<span id="cb25-22"><a href="#cb25-22"></a><span class="co"># Q3 + 1.5 IQR</span></span>
<span id="cb25-23"><a href="#cb25-23"></a>threshold_top <span class="op">=</span> df[<span class="st">'signal40_rol_Q3'</span>] <span class="op">+</span> <span class="fl">1.5</span><span class="op">*</span>df[<span class="st">'signal40_rol_IQR'</span>]</span>
<span id="cb25-24"><a href="#cb25-24"></a>ax0.plot(threshold_top, color<span class="op">=</span><span class="st">"tab:red"</span>)</span>
<span id="cb25-25"><a href="#cb25-25"></a></span>
<span id="cb25-26"><a href="#cb25-26"></a><span class="co"># find and plot outliers</span></span>
<span id="cb25-27"><a href="#cb25-27"></a>outliers_index <span class="op">=</span> df.index[(df[<span class="st">'signal40'</span>] <span class="op">&gt;</span> threshold_top) <span class="op">|</span> </span>
<span id="cb25-28"><a href="#cb25-28"></a>                          (df[<span class="st">'signal40'</span>] <span class="op">&lt;</span> threshold_bottom)</span>
<span id="cb25-29"><a href="#cb25-29"></a>                         ]</span>
<span id="cb25-30"><a href="#cb25-30"></a>ax0.plot(df.loc[outliers_index, <span class="st">'signal40'</span>], ls<span class="op">=</span><span class="st">'None'</span>,</span>
<span id="cb25-31"><a href="#cb25-31"></a>        marker<span class="op">=</span><span class="st">'o'</span>, markerfacecolor<span class="op">=</span><span class="st">'yellow'</span>, markersize<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb25-32"><a href="#cb25-32"></a>        markeredgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb25-33"><a href="#cb25-33"></a><span class="co"># make graph look nice</span></span>
<span id="cb25-34"><a href="#cb25-34"></a>ax0.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">'values'</span>,</span>
<span id="cb25-35"><a href="#cb25-35"></a>       xlim<span class="op">=</span>[start,end],</span>
<span id="cb25-36"><a href="#cb25-36"></a>       ylim<span class="op">=</span>[<span class="op">-</span><span class="dv">45</span>, <span class="dv">120</span>],</span>
<span id="cb25-37"><a href="#cb25-37"></a>       title<span class="op">=</span><span class="vs">r"1-hour rolling threshold: Q $\pm1.5$ IQR"</span>,</span>
<span id="cb25-38"><a href="#cb25-38"></a>       )</span>
<span id="cb25-39"><a href="#cb25-39"></a>concise(ax0)</span>
<span id="cb25-40"><a href="#cb25-40"></a>ax1.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'pdf'</span>,</span>
<span id="cb25-41"><a href="#cb25-41"></a>        ylabel<span class="op">=</span><span class="st">''</span>,</span>
<span id="cb25-42"><a href="#cb25-42"></a>        ylim<span class="op">=</span>[<span class="op">-</span><span class="dv">45</span>, <span class="dv">120</span>],</span>
<span id="cb25-43"><a href="#cb25-43"></a>        yticks<span class="op">=</span>[],</span>
<span id="cb25-44"><a href="#cb25-44"></a>        xticks<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">0.03</span>],</span>
<span id="cb25-45"><a href="#cb25-45"></a>        xticklabels<span class="op">=</span>[<span class="st">'0'</span>, <span class="st">'0.03'</span>]</span>
<span id="cb25-46"><a href="#cb25-46"></a>        )</span>
<span id="cb25-47"><a href="#cb25-47"></a></span>
<span id="cb25-48"><a href="#cb25-48"></a>ax0.legend(frameon<span class="op">=</span><span class="va">False</span>, loc<span class="op">=</span><span class="st">"upper left"</span>)</span>
<span id="cb25-49"><a href="#cb25-49"></a></span>
<span id="cb25-50"><a href="#cb25-50"></a></span>
<span id="cb25-51"><a href="#cb25-51"></a>fig.savefig(<span class="st">"outliers_rolling_IQR.png"</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/c3/7hp0d36n6vv8jc9hm2440__00000gn/T/ipykernel_73326/3108172465.py:6: MatplotlibDeprecationWarning: Auto-removal of overlapping axes is deprecated since 3.6 and will be removed two minor releases later; explicitly call ax.remove() as needed.
  ax0 = plt.subplot(gs[0, 0])
No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="outliers_graphs_files/figure-html/cell-21-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="hampel-running-mad" class="level2" data-number="59.10">
<h2 data-number="59.10" class="anchored" data-anchor-id="hampel-running-mad"><span class="header-section-number">59.10</span> Hampel, running MAD</h2>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1"></a><span class="co"># def MAD(window):</span></span>
<span id="cb27-2"><a href="#cb27-2"></a><span class="co">#     return np.median(                                # 3. compute median</span></span>
<span id="cb27-3"><a href="#cb27-3"></a><span class="co">#                      np.abs(                         # 2. take absolute values</span></span>
<span id="cb27-4"><a href="#cb27-4"></a><span class="co">#                          window - np.median(window)  # 1. calculate residuals</span></span>
<span id="cb27-5"><a href="#cb27-5"></a><span class="co">#                          )</span></span>
<span id="cb27-6"><a href="#cb27-6"></a><span class="co">#                     )</span></span>
<span id="cb27-7"><a href="#cb27-7"></a></span>
<span id="cb27-8"><a href="#cb27-8"></a>k <span class="op">=</span> <span class="fl">1.4826</span> <span class="co"># scale factor for Gaussian distribution</span></span>
<span id="cb27-9"><a href="#cb27-9"></a><span class="kw">def</span> MAD(window):</span>
<span id="cb27-10"><a href="#cb27-10"></a>    <span class="cf">return</span> (window <span class="op">-</span> np.median(window)).<span class="bu">abs</span>().median()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1"></a>df[<span class="st">'signal40_rol_mad'</span>] <span class="op">=</span> k <span class="op">*</span> df[<span class="st">'signal40'</span>].rolling(<span class="st">'60min'</span>, center<span class="op">=</span><span class="va">True</span>).<span class="bu">apply</span>(MAD)</span>
<span id="cb28-2"><a href="#cb28-2"></a>df[<span class="st">'signal40_rol_median'</span>] <span class="op">=</span> df[<span class="st">'signal40'</span>].rolling(<span class="st">'60min'</span>, center<span class="op">=</span><span class="va">True</span>).median()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="23">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>))</span>
<span id="cb29-2"><a href="#cb29-2"></a>gs <span class="op">=</span> gridspec.GridSpec(<span class="dv">1</span>, <span class="dv">2</span>, width_ratios<span class="op">=</span>[<span class="dv">1</span>, <span class="fl">0.2</span>], height_ratios<span class="op">=</span>[<span class="dv">1</span>])</span>
<span id="cb29-3"><a href="#cb29-3"></a>gs.update(left<span class="op">=</span><span class="fl">0.10</span>, right<span class="op">=</span><span class="fl">0.90</span>, top<span class="op">=</span><span class="fl">0.95</span>, bottom<span class="op">=</span><span class="fl">0.13</span>,</span>
<span id="cb29-4"><a href="#cb29-4"></a>          hspace<span class="op">=</span><span class="fl">0.02</span>, wspace<span class="op">=</span><span class="fl">0.02</span>)</span>
<span id="cb29-5"><a href="#cb29-5"></a></span>
<span id="cb29-6"><a href="#cb29-6"></a>ax0 <span class="op">=</span> plt.subplot(gs[<span class="dv">0</span>, <span class="dv">0</span>])</span>
<span id="cb29-7"><a href="#cb29-7"></a>ax1 <span class="op">=</span> plt.subplot(gs[<span class="dv">0</span>, <span class="dv">1</span>])</span>
<span id="cb29-8"><a href="#cb29-8"></a></span>
<span id="cb29-9"><a href="#cb29-9"></a><span class="co"># plot signal</span></span>
<span id="cb29-10"><a href="#cb29-10"></a>ax0.plot(df[<span class="st">'signal40'</span>], color<span class="op">=</span><span class="st">"tab:blue"</span>)</span>
<span id="cb29-11"><a href="#cb29-11"></a></span>
<span id="cb29-12"><a href="#cb29-12"></a>sns.kdeplot(data<span class="op">=</span>df, y<span class="op">=</span><span class="st">'signal40'</span>, shade<span class="op">=</span><span class="va">True</span>, ax<span class="op">=</span>ax1)</span>
<span id="cb29-13"><a href="#cb29-13"></a></span>
<span id="cb29-14"><a href="#cb29-14"></a><span class="co"># median</span></span>
<span id="cb29-15"><a href="#cb29-15"></a><span class="co"># ax0.plot(df['signal40_rol_median'], color="black", alpha=0.7, label="median")</span></span>
<span id="cb29-16"><a href="#cb29-16"></a><span class="co"># Q1 - 1.5 IQR</span></span>
<span id="cb29-17"><a href="#cb29-17"></a>threshold_bottom <span class="op">=</span> df[<span class="st">'signal40_rol_median'</span>] <span class="op">-</span> <span class="dv">3</span> <span class="op">*</span> df[<span class="st">'signal40_rol_mad'</span>]</span>
<span id="cb29-18"><a href="#cb29-18"></a>ax0.plot(threshold_bottom, color<span class="op">=</span><span class="st">"tab:red"</span>)</span>
<span id="cb29-19"><a href="#cb29-19"></a><span class="co"># Q3 + 1.5 IQR</span></span>
<span id="cb29-20"><a href="#cb29-20"></a>threshold_top <span class="op">=</span> df[<span class="st">'signal40_rol_median'</span>] <span class="op">+</span> <span class="dv">3</span> <span class="op">*</span> df[<span class="st">'signal40_rol_mad'</span>]</span>
<span id="cb29-21"><a href="#cb29-21"></a>ax0.plot(threshold_top, color<span class="op">=</span><span class="st">"tab:red"</span>)</span>
<span id="cb29-22"><a href="#cb29-22"></a></span>
<span id="cb29-23"><a href="#cb29-23"></a><span class="co"># find and plot outliers</span></span>
<span id="cb29-24"><a href="#cb29-24"></a>outliers_index <span class="op">=</span> df.index[(df[<span class="st">'signal40'</span>] <span class="op">&gt;</span> threshold_top) <span class="op">|</span> </span>
<span id="cb29-25"><a href="#cb29-25"></a>                          (df[<span class="st">'signal40'</span>] <span class="op">&lt;</span> threshold_bottom)</span>
<span id="cb29-26"><a href="#cb29-26"></a>                         ]</span>
<span id="cb29-27"><a href="#cb29-27"></a>ax0.plot(df.loc[outliers_index, <span class="st">'signal40'</span>], ls<span class="op">=</span><span class="st">'None'</span>,</span>
<span id="cb29-28"><a href="#cb29-28"></a>        marker<span class="op">=</span><span class="st">'o'</span>, markerfacecolor<span class="op">=</span><span class="st">'yellow'</span>, markersize<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb29-29"><a href="#cb29-29"></a>        markeredgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb29-30"><a href="#cb29-30"></a><span class="co"># make graph look nice</span></span>
<span id="cb29-31"><a href="#cb29-31"></a>ax0.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">'values'</span>,</span>
<span id="cb29-32"><a href="#cb29-32"></a>       xlim<span class="op">=</span>[start,end],</span>
<span id="cb29-33"><a href="#cb29-33"></a>       ylim<span class="op">=</span>[<span class="op">-</span><span class="dv">45</span>, <span class="dv">120</span>],</span>
<span id="cb29-34"><a href="#cb29-34"></a>       title<span class="op">=</span><span class="vs">r"1-hour rolling threshold: median $\pm3$ MAD"</span>,</span>
<span id="cb29-35"><a href="#cb29-35"></a>       )</span>
<span id="cb29-36"><a href="#cb29-36"></a>concise(ax0)</span>
<span id="cb29-37"><a href="#cb29-37"></a>ax1.<span class="bu">set</span>(xlabel<span class="op">=</span><span class="st">'pdf'</span>,</span>
<span id="cb29-38"><a href="#cb29-38"></a>        ylabel<span class="op">=</span><span class="st">''</span>,</span>
<span id="cb29-39"><a href="#cb29-39"></a>        ylim<span class="op">=</span>[<span class="op">-</span><span class="dv">45</span>, <span class="dv">120</span>],</span>
<span id="cb29-40"><a href="#cb29-40"></a>        yticks<span class="op">=</span>[],</span>
<span id="cb29-41"><a href="#cb29-41"></a>        xticks<span class="op">=</span>[<span class="dv">0</span>, <span class="fl">0.03</span>],</span>
<span id="cb29-42"><a href="#cb29-42"></a>        xticklabels<span class="op">=</span>[<span class="st">'0'</span>, <span class="st">'0.03'</span>]</span>
<span id="cb29-43"><a href="#cb29-43"></a>        )</span>
<span id="cb29-44"><a href="#cb29-44"></a></span>
<span id="cb29-45"><a href="#cb29-45"></a>ax0.legend(frameon<span class="op">=</span><span class="va">False</span>, loc<span class="op">=</span><span class="st">"upper left"</span>)</span>
<span id="cb29-46"><a href="#cb29-46"></a></span>
<span id="cb29-47"><a href="#cb29-47"></a></span>
<span id="cb29-48"><a href="#cb29-48"></a>fig.savefig(<span class="st">"outliers_rolling_MAD.png"</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/c3/7hp0d36n6vv8jc9hm2440__00000gn/T/ipykernel_73326/3446982039.py:6: MatplotlibDeprecationWarning: Auto-removal of overlapping axes is deprecated since 3.6 and will be removed two minor releases later; explicitly call ax.remove() as needed.
  ax0 = plt.subplot(gs[0, 0])
No artists with labels found to put in legend.  Note that artists whose label start with an underscore are ignored when legend() is called with no argument.</code></pre>
</div>
<div class="cell-output cell-output-display">
<p><img src="outliers_graphs_files/figure-html/cell-24-output-2.png" class="img-fluid"></p>
</div>
</div>
</section>
<section id="stationary-mad" class="level2" data-number="59.11">
<h2 data-number="59.11" class="anchored" data-anchor-id="stationary-mad"><span class="header-section-number">59.11</span> stationary MAD</h2>
<div class="cell" data-execution_count="35">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>))</span>
<span id="cb31-2"><a href="#cb31-2"></a><span class="co"># plot signal</span></span>
<span id="cb31-3"><a href="#cb31-3"></a>ax.plot(df[<span class="st">'signal'</span>], color<span class="op">=</span><span class="st">"tab:blue"</span>)</span>
<span id="cb31-4"><a href="#cb31-4"></a></span>
<span id="cb31-5"><a href="#cb31-5"></a>k <span class="op">=</span> <span class="fl">1.4826</span> <span class="co"># scale factor for Gaussian distribution</span></span>
<span id="cb31-6"><a href="#cb31-6"></a>mad <span class="op">=</span> median_abs_deviation(df[<span class="st">'signal'</span>])</span>
<span id="cb31-7"><a href="#cb31-7"></a>median <span class="op">=</span> df[<span class="st">'signal'</span>].median()</span>
<span id="cb31-8"><a href="#cb31-8"></a></span>
<span id="cb31-9"><a href="#cb31-9"></a>xlim <span class="op">=</span> ax.get_xlim()</span>
<span id="cb31-10"><a href="#cb31-10"></a></span>
<span id="cb31-11"><a href="#cb31-11"></a><span class="co"># median +- 3*k*mad</span></span>
<span id="cb31-12"><a href="#cb31-12"></a>ax.plot([start, end], [median]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb31-13"><a href="#cb31-13"></a><span class="co"># ax.text(1.1, median, "median", va="center", transform=ax.transAxes,)</span></span>
<span id="cb31-14"><a href="#cb31-14"></a></span>
<span id="cb31-15"><a href="#cb31-15"></a>threshold_top <span class="op">=</span> median<span class="op">+</span><span class="dv">3</span><span class="op">*</span>k<span class="op">*</span>mad</span>
<span id="cb31-16"><a href="#cb31-16"></a>threshold_bottom <span class="op">=</span> median<span class="op">-</span><span class="dv">3</span><span class="op">*</span>k<span class="op">*</span>mad</span>
<span id="cb31-17"><a href="#cb31-17"></a></span>
<span id="cb31-18"><a href="#cb31-18"></a>ax.plot([start, end], [threshold_bottom]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb31-19"><a href="#cb31-19"></a>ax.plot([start, end], [threshold_top]<span class="op">*</span><span class="dv">2</span>, color<span class="op">=</span><span class="st">"black"</span>, alpha<span class="op">=</span><span class="fl">0.4</span>)</span>
<span id="cb31-20"><a href="#cb31-20"></a></span>
<span id="cb31-21"><a href="#cb31-21"></a>ax.annotate(<span class="st">"median"</span>, xy<span class="op">=</span>(<span class="fl">1.02</span>, median), xycoords<span class="op">=</span>(<span class="st">'axes fraction'</span>, <span class="st">'data'</span>),</span>
<span id="cb31-22"><a href="#cb31-22"></a>            va<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb31-23"><a href="#cb31-23"></a>ax.annotate(<span class="vs">r"median$+3k\cdot$MAD"</span>, xy<span class="op">=</span>(<span class="fl">1.02</span>, threshold_top), xycoords<span class="op">=</span>(<span class="st">'axes fraction'</span>, <span class="st">'data'</span>),</span>
<span id="cb31-24"><a href="#cb31-24"></a>            va<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb31-25"><a href="#cb31-25"></a>ax.annotate(<span class="vs">r"median$-3k\cdot$MAD"</span>, xy<span class="op">=</span>(<span class="fl">1.02</span>, threshold_bottom), xycoords<span class="op">=</span>(<span class="st">'axes fraction'</span>, <span class="st">'data'</span>),</span>
<span id="cb31-26"><a href="#cb31-26"></a>            va<span class="op">=</span><span class="st">'center'</span>)</span>
<span id="cb31-27"><a href="#cb31-27"></a></span>
<span id="cb31-28"><a href="#cb31-28"></a><span class="co"># find and plot outliers</span></span>
<span id="cb31-29"><a href="#cb31-29"></a>outliers_index <span class="op">=</span> df.index[(df[<span class="st">'signal'</span>] <span class="op">&gt;</span> threshold_top) <span class="op">|</span> </span>
<span id="cb31-30"><a href="#cb31-30"></a>                          (df[<span class="st">'signal'</span>] <span class="op">&lt;</span> threshold_bottom)</span>
<span id="cb31-31"><a href="#cb31-31"></a>                         ]</span>
<span id="cb31-32"><a href="#cb31-32"></a>ax.plot(df.loc[outliers_index, <span class="st">'signal'</span>], ls<span class="op">=</span><span class="st">'None'</span>,</span>
<span id="cb31-33"><a href="#cb31-33"></a>        marker<span class="op">=</span><span class="st">'o'</span>, markerfacecolor<span class="op">=</span><span class="st">'yellow'</span>, markersize<span class="op">=</span><span class="dv">5</span>,</span>
<span id="cb31-34"><a href="#cb31-34"></a>        markeredgecolor<span class="op">=</span><span class="st">"black"</span>)</span>
<span id="cb31-35"><a href="#cb31-35"></a></span>
<span id="cb31-36"><a href="#cb31-36"></a><span class="co"># make graph look nice</span></span>
<span id="cb31-37"><a href="#cb31-37"></a>ax.<span class="bu">set</span>(ylabel<span class="op">=</span><span class="st">'values'</span>,</span>
<span id="cb31-38"><a href="#cb31-38"></a>       xlim<span class="op">=</span>[start,end],</span>
<span id="cb31-39"><a href="#cb31-39"></a>       title<span class="op">=</span><span class="st">"a stationary signal"</span>,</span>
<span id="cb31-40"><a href="#cb31-40"></a>       ylim<span class="op">=</span>[<span class="op">-</span><span class="dv">45</span>, <span class="dv">80</span>])</span>
<span id="cb31-41"><a href="#cb31-41"></a>concise(ax)</span>
<span id="cb31-42"><a href="#cb31-42"></a>fig.savefig(<span class="st">"outliers_MAD_stationary.png"</span>, bbox_inches<span class="op">=</span><span class="st">'tight'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<p><img src="outliers_graphs_files/figure-html/cell-25-output-1.png" class="img-fluid"></p>
</div>
</div>
<div class="cell" data-execution_count="32">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1"></a>outliers_index</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="32">
<pre><code>DatetimeIndex(['2023-01-10 04:09:00', '2023-01-10 14:05:00',
               '2023-01-10 15:14:00'],
              dtype='datetime64[ns]', name='date', freq=None)</code></pre>
</div>
</div>
</section>
<section id="save-data-as-csv-for-later-usage" class="level2" data-number="59.12">
<h2 data-number="59.12" class="anchored" data-anchor-id="save-data-as-csv-for-later-usage"><span class="header-section-number">59.12</span> save data as csv for later usage</h2>
<div class="cell" data-execution_count="15">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1"></a>start <span class="op">=</span> <span class="st">'2023-01-01 00:00:00'</span></span>
<span id="cb34-2"><a href="#cb34-2"></a>end <span class="op">=</span> <span class="st">'2023-12-31 23:55:00'</span></span>
<span id="cb34-3"><a href="#cb34-3"></a><span class="co"># date_range = pd.date_range(start, end, freq='5min')</span></span>
<span id="cb34-4"><a href="#cb34-4"></a>date_range <span class="op">=</span> pd.date_range(start, end, freq<span class="op">=</span><span class="st">'1D'</span>)</span>
<span id="cb34-5"><a href="#cb34-5"></a>n_steps <span class="op">=</span> <span class="bu">len</span>(date_range)</span>
<span id="cb34-6"><a href="#cb34-6"></a>rw39, outlier_ind39 <span class="op">=</span> random_walk_with_outliers(origin<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb34-7"><a href="#cb34-7"></a>                                            n_steps<span class="op">=</span>n_steps,</span>
<span id="cb34-8"><a href="#cb34-8"></a>                                            perc_outliers<span class="op">=</span><span class="fl">0.0031</span>,</span>
<span id="cb34-9"><a href="#cb34-9"></a>                                            outlier_mult<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb34-10"><a href="#cb34-10"></a>                                            seed<span class="op">=</span><span class="dv">39</span>)</span>
<span id="cb34-11"><a href="#cb34-11"></a><span class="co"># date_range = pd.date_range(start, periods=n_steps, freq='1min')</span></span>
<span id="cb34-12"><a href="#cb34-12"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'date'</span>: date_range, <span class="st">'A'</span>: rw39}).set_index(<span class="st">'date'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="16">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1"></a><span class="op">%</span>matplotlib widget</span>
<span id="cb35-2"><a href="#cb35-2"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>))</span>
<span id="cb35-3"><a href="#cb35-3"></a></span>
<span id="cb35-4"><a href="#cb35-4"></a>ax.plot(df[<span class="st">'A'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7f96008c88fd4284a7d087260c32f041","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div class="cell" data-execution_count="21">
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1"></a>df.loc[<span class="st">'2023-03-02'</span>:<span class="st">'2023-03-10'</span>, <span class="st">'A'</span>] <span class="op">=</span> <span class="op">-</span><span class="fl">20.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="22">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1"></a><span class="op">%</span>matplotlib widget</span>
<span id="cb37-2"><a href="#cb37-2"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>))</span>
<span id="cb37-3"><a href="#cb37-3"></a>df[<span class="st">'Adiff'</span>] <span class="op">=</span> df[<span class="st">'A'</span>].diff()</span>
<span id="cb37-4"><a href="#cb37-4"></a>ax.plot(df[<span class="st">'A'</span>])</span>
<span id="cb37-5"><a href="#cb37-5"></a>ax.plot(df[<span class="st">'Adiff'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"6fb1d654f15342649853af893623a668","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div class="cell" data-execution_count="33">
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1"></a>(df.loc[<span class="st">'2023-03-03'</span>:<span class="st">'2023-03-06'</span>, <span class="st">'Adiff'</span>] <span class="op">==</span> np.zeros(<span class="dv">4</span>)).<span class="bu">all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="33">
<pre><code>True</code></pre>
</div>
</div>
<div class="cell" data-execution_count="29">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1"></a>df.loc[<span class="st">'2023-03-03'</span>:<span class="st">'2023-03-06'</span>, <span class="st">'Adiff'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="29">
<pre><code>date
2023-03-03    0.0
2023-03-04    0.0
2023-03-05    0.0
2023-03-06    0.0
Name: Adiff, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="28">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1"></a>np.zeros(<span class="dv">4</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="28">
<pre><code>array([0., 0., 0., 0.])</code></pre>
</div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1"></a>n_consecutive <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb44-2"><a href="#cb44-2"></a></span>
<span id="cb44-3"><a href="#cb44-3"></a><span class="kw">def</span> n_zeros(series, N):</span>
<span id="cb44-4"><a href="#cb44-4"></a>    <span class="co">"""</span></span>
<span id="cb44-5"><a href="#cb44-5"></a><span class="co">    True if all series equals np.zeros(N)</span></span>
<span id="cb44-6"><a href="#cb44-6"></a><span class="co">    False otherwise</span></span>
<span id="cb44-7"><a href="#cb44-7"></a><span class="co">    """</span></span>
<span id="cb44-8"><a href="#cb44-8"></a>    <span class="cf">return</span> (series <span class="op">==</span> np.zeros(N)).<span class="bu">all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="55">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1"></a>df[<span class="st">'mask1'</span>] <span class="op">=</span> df[<span class="st">'Adiff'</span>].rolling(n_consecutive).<span class="bu">apply</span>(n_zeros, args<span class="op">=</span>(n_consecutive,))</span>
<span id="cb45-2"><a href="#cb45-2"></a>df[<span class="st">'mask'</span>] <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb45-3"><a href="#cb45-3"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(df)):</span>
<span id="cb45-4"><a href="#cb45-4"></a>    <span class="cf">if</span> df[<span class="st">'mask1'</span>][i] <span class="op">==</span> <span class="fl">1.0</span>:</span>
<span id="cb45-5"><a href="#cb45-5"></a>        df[<span class="st">'mask'</span>][i<span class="op">-</span>n_consecutive:i<span class="op">+</span><span class="dv">1</span>] <span class="op">=</span> <span class="fl">1.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/kv/9cqw3y_s6c75xmgqm9n0t5d40000gn/T/ipykernel_6180/2921310703.py:5: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df['mask'][i-n_consecutive:i+1] = 1.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="56">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1"></a><span class="op">%</span>matplotlib widget</span>
<span id="cb47-2"><a href="#cb47-2"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>))</span>
<span id="cb47-3"><a href="#cb47-3"></a>ax.plot(df[<span class="st">'mask1'</span>])</span>
<span id="cb47-4"><a href="#cb47-4"></a>ax.plot(df[<span class="st">'mask'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"bd157e4be435441fb3204aa2ba2bc809","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1"></a>df[<span class="st">'mask'</span>] <span class="op">=</span> <span class="fl">0.0</span></span>
<span id="cb48-2"><a href="#cb48-2"></a><span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(df)<span class="op">-</span>n_consecutive):</span>
<span id="cb48-3"><a href="#cb48-3"></a>    <span class="cf">if</span> (df[<span class="st">'Adiff'</span>][j:j<span class="op">+</span>n_consecutive] <span class="op">==</span> np.zeros(n_consecutive)).<span class="bu">all</span>():</span>
<span id="cb48-4"><a href="#cb48-4"></a>        df[<span class="st">'mask'</span>][j:j<span class="op">+</span>n_consecutive] <span class="op">=</span> <span class="fl">1.0</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/kv/9cqw3y_s6c75xmgqm9n0t5d40000gn/T/ipykernel_6180/2364603426.py:4: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df['mask'][j:j+n_consecutive] = 1.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1"></a><span class="op">%</span>matplotlib widget</span>
<span id="cb50-2"><a href="#cb50-2"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>))</span>
<span id="cb50-3"><a href="#cb50-3"></a><span class="co"># ax.plot(df['mask1'])</span></span>
<span id="cb50-4"><a href="#cb50-4"></a>ax.plot(df[<span class="st">'mask'</span>])</span>
<span id="cb50-5"><a href="#cb50-5"></a>ax.plot(df[<span class="st">'Adiff'</span>])</span>
<span id="cb50-6"><a href="#cb50-6"></a>ax.plot(df[<span class="st">'A'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"7bb82949cfd046cfa09ed6d7217d4978","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
</section>
<section id="generate-datasets" class="level2" data-number="59.13">
<h2 data-number="59.13" class="anchored" data-anchor-id="generate-datasets"><span class="header-section-number">59.13</span> generate datasets</h2>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1"></a><span class="kw">def</span> random_walk_with_outliers2(origin, steps_dist, outlier_dist, n_steps, perc_outliers<span class="op">=</span><span class="fl">0.0</span>, outlier_mult<span class="op">=</span><span class="dv">10</span>, seed<span class="op">=</span><span class="dv">42</span>):</span>
<span id="cb51-2"><a href="#cb51-2"></a>    <span class="co">'''</span></span>
<span id="cb51-3"><a href="#cb51-3"></a><span class="co">    Function for generating a random time series based on random walk.</span></span>
<span id="cb51-4"><a href="#cb51-4"></a><span class="co">    It adds a specified percentage of outliers by multiplying the random walk step by a scalar.</span></span>
<span id="cb51-5"><a href="#cb51-5"></a><span class="co">    </span></span>
<span id="cb51-6"><a href="#cb51-6"></a><span class="co">    Parameters</span></span>
<span id="cb51-7"><a href="#cb51-7"></a><span class="co">    ------------</span></span>
<span id="cb51-8"><a href="#cb51-8"></a><span class="co">    origin : int</span></span>
<span id="cb51-9"><a href="#cb51-9"></a><span class="co">        The starting point of the series</span></span>
<span id="cb51-10"><a href="#cb51-10"></a><span class="co">    steps_dist : list of int or float</span></span>
<span id="cb51-11"><a href="#cb51-11"></a><span class="co">        step distribution</span></span>
<span id="cb51-12"><a href="#cb51-12"></a><span class="co">    outlier_dist : list of int or float</span></span>
<span id="cb51-13"><a href="#cb51-13"></a><span class="co">        outlier distribution</span></span>
<span id="cb51-14"><a href="#cb51-14"></a><span class="co">    n_steps : int</span></span>
<span id="cb51-15"><a href="#cb51-15"></a><span class="co">        Lenght of the series</span></span>
<span id="cb51-16"><a href="#cb51-16"></a><span class="co">    perc_outliers : float</span></span>
<span id="cb51-17"><a href="#cb51-17"></a><span class="co">        Percentage of outliers to introduce to the series [0.0-1.0]</span></span>
<span id="cb51-18"><a href="#cb51-18"></a><span class="co">    outlier_mult : float</span></span>
<span id="cb51-19"><a href="#cb51-19"></a><span class="co">        Scalar by which to multiply the RW increment to create an outlier</span></span>
<span id="cb51-20"><a href="#cb51-20"></a><span class="co">    seed : int</span></span>
<span id="cb51-21"><a href="#cb51-21"></a><span class="co">        Random seed</span></span>
<span id="cb51-22"><a href="#cb51-22"></a></span>
<span id="cb51-23"><a href="#cb51-23"></a><span class="co">    Returns</span></span>
<span id="cb51-24"><a href="#cb51-24"></a><span class="co">    -----------</span></span>
<span id="cb51-25"><a href="#cb51-25"></a><span class="co">    rw : np.ndarray</span></span>
<span id="cb51-26"><a href="#cb51-26"></a><span class="co">        The generated random walk series with outliers</span></span>
<span id="cb51-27"><a href="#cb51-27"></a><span class="co">    indices : np.ndarray</span></span>
<span id="cb51-28"><a href="#cb51-28"></a><span class="co">        The indices of the introduced outliers </span></span>
<span id="cb51-29"><a href="#cb51-29"></a><span class="co">    '''</span></span>
<span id="cb51-30"><a href="#cb51-30"></a>    <span class="cf">assert</span> (perc_outliers <span class="op">&gt;=</span> <span class="fl">0.0</span>) <span class="op">&amp;</span> (perc_outliers <span class="op">&lt;=</span> <span class="fl">1.0</span>)</span>
<span id="cb51-31"><a href="#cb51-31"></a>    </span>
<span id="cb51-32"><a href="#cb51-32"></a>    <span class="co">#set seed for reproducibility</span></span>
<span id="cb51-33"><a href="#cb51-33"></a>    np.random.seed(seed)</span>
<span id="cb51-34"><a href="#cb51-34"></a>    </span>
<span id="cb51-35"><a href="#cb51-35"></a>    <span class="co"># possible steps</span></span>
<span id="cb51-36"><a href="#cb51-36"></a>    <span class="co"># steps = [-1, 1]</span></span>
<span id="cb51-37"><a href="#cb51-37"></a></span>
<span id="cb51-38"><a href="#cb51-38"></a>    <span class="co"># simulate steps</span></span>
<span id="cb51-39"><a href="#cb51-39"></a>    steps <span class="op">=</span> np.random.choice(a<span class="op">=</span>steps_dist, size<span class="op">=</span>n_steps<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb51-40"><a href="#cb51-40"></a>    rw <span class="op">=</span> np.append(origin, steps).cumsum(<span class="dv">0</span>)</span>
<span id="cb51-41"><a href="#cb51-41"></a>    </span>
<span id="cb51-42"><a href="#cb51-42"></a>    <span class="co"># add outliers</span></span>
<span id="cb51-43"><a href="#cb51-43"></a>    n_outliers <span class="op">=</span> <span class="bu">int</span>(np.<span class="bu">round</span>(perc_outliers <span class="op">*</span> n_steps, <span class="dv">0</span>))</span>
<span id="cb51-44"><a href="#cb51-44"></a>    indices <span class="op">=</span> np.random.randint(<span class="dv">0</span>, <span class="bu">len</span>(rw), n_outliers)</span>
<span id="cb51-45"><a href="#cb51-45"></a>    outlier_jumps <span class="op">=</span> np.random.choice(a<span class="op">=</span>outlier_dist, size<span class="op">=</span>n_outliers)</span>
<span id="cb51-46"><a href="#cb51-46"></a>    <span class="co"># rw[indices] = rw[indices] + steps[indices + 1] * outlier_mult</span></span>
<span id="cb51-47"><a href="#cb51-47"></a>    rw[indices] <span class="op">=</span> rw[indices] <span class="op">+</span> outlier_jumps</span>
<span id="cb51-48"><a href="#cb51-48"></a>    </span>
<span id="cb51-49"><a href="#cb51-49"></a>    <span class="cf">return</span> rw, indices</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="66">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1"></a>rw39test, _ <span class="op">=</span> random_walk_with_outliers2(origin<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb52-2"><a href="#cb52-2"></a>                                       steps_dist<span class="op">=</span>np.random.normal(size<span class="op">=</span><span class="dv">1000</span>),</span>
<span id="cb52-3"><a href="#cb52-3"></a>                                       outlier_dist<span class="op">=</span><span class="dv">10</span><span class="op">*</span>np.random.normal(loc<span class="op">=</span><span class="fl">5.0</span>, size<span class="op">=</span><span class="dv">100</span>),</span>
<span id="cb52-4"><a href="#cb52-4"></a>                                       n_steps<span class="op">=</span>n_steps,</span>
<span id="cb52-5"><a href="#cb52-5"></a>                                       perc_outliers<span class="op">=</span><span class="fl">0.0002</span>,</span>
<span id="cb52-6"><a href="#cb52-6"></a>                                       outlier_mult<span class="op">=</span><span class="dv">50</span>,</span>
<span id="cb52-7"><a href="#cb52-7"></a>                                       seed<span class="op">=</span><span class="dv">206</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="46">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1"></a>df[<span class="st">'B'</span>] <span class="op">=</span> rw39test</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="65">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1"></a>start <span class="op">=</span> <span class="st">'2023-01-01 00:00:00'</span></span>
<span id="cb54-2"><a href="#cb54-2"></a>end <span class="op">=</span> <span class="st">'2023-12-31 23:00:00'</span></span>
<span id="cb54-3"><a href="#cb54-3"></a><span class="co"># date_range = pd.date_range(start, end, freq='5min')</span></span>
<span id="cb54-4"><a href="#cb54-4"></a>date_range <span class="op">=</span> pd.date_range(start, end, freq<span class="op">=</span><span class="st">'1D'</span>)</span>
<span id="cb54-5"><a href="#cb54-5"></a>n_steps <span class="op">=</span> <span class="bu">len</span>(date_range)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="68">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1"></a><span class="co"># date_range = pd.date_range(start, periods=n_steps, freq='1min')</span></span>
<span id="cb55-2"><a href="#cb55-2"></a>df <span class="op">=</span> pd.DataFrame({<span class="st">'date'</span>: date_range, <span class="st">'A'</span>: rw39test}).set_index(<span class="st">'date'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="71">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="71">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">A</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-01-01</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-01-02</td>
<td>-0.032027</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-01-03</td>
<td>-0.586351</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-01-04</td>
<td>-1.575972</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-01-05</td>
<td>-2.726800</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-12-27</td>
<td>6.651301</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-12-28</td>
<td>6.415175</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-12-29</td>
<td>7.603140</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-12-30</td>
<td>8.668182</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-12-31</td>
<td>8.472768</td>
</tr>
</tbody>
</table>

<p>365 rows × 1 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="70">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1"></a>df[<span class="st">'unix_time'</span>] <span class="op">=</span> df.index.timestamp()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>AttributeError: 'DatetimeIndex' object has no attribute 'timestamp'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="69">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="69">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">A</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-01-01</td>
<td>0.000000</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-01-02</td>
<td>-0.032027</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-01-03</td>
<td>-0.586351</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-01-04</td>
<td>-1.575972</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-01-05</td>
<td>-2.726800</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-12-27</td>
<td>6.651301</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-12-28</td>
<td>6.415175</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-12-29</td>
<td>7.603140</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-12-30</td>
<td>8.668182</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-12-31</td>
<td>8.472768</td>
</tr>
</tbody>
</table>

<p>365 rows × 1 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1"></a>rw02, outlier_ind02 <span class="op">=</span> random_walk_with_outliers(origin<span class="op">=</span><span class="dv">0</span>,</span>
<span id="cb60-2"><a href="#cb60-2"></a>                                            n_steps<span class="op">=</span>n_steps,</span>
<span id="cb60-3"><a href="#cb60-3"></a>                                            perc_outliers<span class="op">=</span><span class="fl">0.0001</span>,</span>
<span id="cb60-4"><a href="#cb60-4"></a>                                            outlier_mult<span class="op">=</span><span class="dv">500</span>,</span>
<span id="cb60-5"><a href="#cb60-5"></a>                                            seed<span class="op">=</span><span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="31">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1"></a>df.loc[<span class="st">'2023-01-02 23:00:00'</span>:<span class="st">'2023-01-03 03:00:00'</span>, <span class="st">'E'</span>] <span class="op">=</span> np.nan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="34">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1"></a>df.iloc[np.random.randint(<span class="dv">0</span>, high<span class="op">=</span><span class="bu">len</span>(df), size<span class="op">=</span><span class="dv">600</span>)][<span class="st">'E'</span>] <span class="op">=</span> np.nan</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>/var/folders/kv/9cqw3y_s6c75xmgqm9n0t5d40000gn/T/ipykernel_9222/2255542716.py:1: SettingWithCopyWarning: 
A value is trying to be set on a copy of a slice from a DataFrame.
Try using .loc[row_indexer,col_indexer] = value instead

See the caveats in the documentation: https://pandas.pydata.org/pandas-docs/stable/user_guide/indexing.html#returning-a-view-versus-a-copy
  df.iloc[np.random.randint(0, high=len(df), size=600)]['E'] = np.nan</code></pre>
</div>
</div>
<div class="cell" data-execution_count="67">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1"></a><span class="op">%</span>matplotlib widget</span>
<span id="cb64-2"><a href="#cb64-2"></a>fig, ax <span class="op">=</span> plt.subplots(figsize<span class="op">=</span>(<span class="dv">8</span>,<span class="dv">4</span>))</span>
<span id="cb64-3"><a href="#cb64-3"></a><span class="co"># ax.plot(df['B'])</span></span>
<span id="cb64-4"><a href="#cb64-4"></a>ax.plot(rw39test)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<script type="application/vnd.jupyter.widget-view+json">
{"model_id":"00b0226346f245ccbae1496ce6026a58","version_major":2,"version_minor":0,"quarto_mimetype":"application/vnd.jupyter.widget-view+json"}
</script>
</div>
</div>
<div class="cell" data-execution_count="52">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1"></a>df[<span class="st">'date'</span>] <span class="op">=</span> df.index.strftime(<span class="st">'</span><span class="sc">%d</span><span class="st">%m%Y'</span>)</span>
<span id="cb65-2"><a href="#cb65-2"></a>df[<span class="st">'time'</span>] <span class="op">=</span> df.index.strftime(<span class="st">'%H:%M:%S'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="103">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1"></a>df[<span class="st">'unix time (s)'</span>] <span class="op">=</span> df.index.view(<span class="st">'int64'</span>) <span class="op">/</span> <span class="fl">1e9</span></span>
<span id="cb66-2"><a href="#cb66-2"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="103">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">A</th>
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th">unix time (s)</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-01-01</td>
<td>0.000000</td>
<td>2023-01-01</td>
<td>1.672531e+09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-01-02</td>
<td>-0.032027</td>
<td>2023-01-02</td>
<td>1.672618e+09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-01-03</td>
<td>-0.586351</td>
<td>2023-01-03</td>
<td>1.672704e+09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-01-04</td>
<td>-1.575972</td>
<td>2023-01-04</td>
<td>1.672790e+09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-01-05</td>
<td>-2.726800</td>
<td>2023-01-05</td>
<td>1.672877e+09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-12-27</td>
<td>6.651301</td>
<td>2023-12-27</td>
<td>1.703635e+09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-12-28</td>
<td>6.415175</td>
<td>2023-12-28</td>
<td>1.703722e+09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-12-29</td>
<td>7.603140</td>
<td>2023-12-29</td>
<td>1.703808e+09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-12-30</td>
<td>8.668182</td>
<td>2023-12-30</td>
<td>1.703894e+09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-12-31</td>
<td>8.472768</td>
<td>2023-12-31</td>
<td>1.703981e+09</td>
</tr>
</tbody>
</table>

<p>365 rows × 3 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="104">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1"></a>df.drop(columns<span class="op">=</span>[<span class="st">'date'</span>], inplace<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb67-2"><a href="#cb67-2"></a>df</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="104">
<div>


<table class="dataframe table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">A</th>
<th data-quarto-table-cell-role="th">unix time (s)</th>
</tr>
<tr class="odd">
<th data-quarto-table-cell-role="th">date</th>
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th"></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-01-01</td>
<td>0.000000</td>
<td>1.672531e+09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-01-02</td>
<td>-0.032027</td>
<td>1.672618e+09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-01-03</td>
<td>-0.586351</td>
<td>1.672704e+09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-01-04</td>
<td>-1.575972</td>
<td>1.672790e+09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-01-05</td>
<td>-2.726800</td>
<td>1.672877e+09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">...</td>
<td>...</td>
<td>...</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-12-27</td>
<td>6.651301</td>
<td>1.703635e+09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-12-28</td>
<td>6.415175</td>
<td>1.703722e+09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-12-29</td>
<td>7.603140</td>
<td>1.703808e+09</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">2023-12-30</td>
<td>8.668182</td>
<td>1.703894e+09</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2023-12-31</td>
<td>8.472768</td>
<td>1.703981e+09</td>
</tr>
</tbody>
</table>

<p>365 rows × 2 columns</p>
</div>
</div>
</div>
<div class="cell" data-execution_count="60">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1"></a>df.loc[<span class="st">'2023-10-11 03:00:00'</span>, <span class="st">'B'</span>] <span class="op">=</span> <span class="st">'-'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="105">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1"></a>df.to_csv(<span class="st">'cleaning3.csv'</span>, index<span class="op">=</span><span class="va">False</span>, sep<span class="op">=</span><span class="st">' '</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="64">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1"></a>df[<span class="st">'A'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="64">
<pre><code>date
2023-01-01 00:00:00     0.000000
2023-01-01 01:00:00    -2.027536
2023-01-01 02:00:00    -2.690617
2023-01-01 03:00:00    -1.985990
2023-01-01 04:00:00    -2.290898
                         ...    
2023-12-31 19:00:00   -74.514645
2023-12-31 20:00:00   -74.738058
2023-12-31 21:00:00   -75.848425
2023-12-31 22:00:00   -77.272183
2023-12-31 23:00:00   -76.557400
Name: A, Length: 8760, dtype: float64</code></pre>
</div>
</div>
<div class="cell" data-execution_count="72">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1"></a><span class="im">import</span> datetime</span>
<span id="cb72-2"><a href="#cb72-2"></a><span class="im">import</span> time</span>
<span id="cb72-3"><a href="#cb72-3"></a></span>
<span id="cb72-4"><a href="#cb72-4"></a>dt <span class="op">=</span> datetime.datetime.now()</span>
<span id="cb72-5"><a href="#cb72-5"></a>timestamp <span class="op">=</span> time.mktime(dt.timetuple())</span>
<span id="cb72-6"><a href="#cb72-6"></a><span class="bu">print</span>(timestamp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>1705330442.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="73">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1"></a>timestamp</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="73">
<pre><code>1705330442.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="74">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1"></a>dt</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="74">
<pre><code>datetime.datetime(2024, 1, 15, 16, 54, 2, 420872)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="76">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1"></a>dt.timetuple()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="76">
<pre><code>time.struct_time(tm_year=2024, tm_mon=1, tm_mday=15, tm_hour=16, tm_min=54, tm_sec=2, tm_wday=0, tm_yday=15, tm_isdst=-1)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="75">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1"></a>pd.to_datetime(<span class="fl">1705330442.0</span>, unit<span class="op">=</span><span class="st">'s'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="75">
<pre><code>Timestamp('2024-01-15 14:54:02')</code></pre>
</div>
</div>
<div class="cell" data-execution_count="83">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1"></a>(df.index.values).<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.timetuple())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>AttributeError: 'numpy.ndarray' object has no attribute 'apply'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="85">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1"></a>df[<span class="st">'date'</span>] <span class="op">=</span> df.index.strftime(<span class="st">'%Y-%m-</span><span class="sc">%d</span><span class="st">'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="87">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1"></a>df[<span class="st">'date'</span>].<span class="bu">apply</span>(<span class="kw">lambda</span> x: x.timetuple())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-error">
<pre><code>AttributeError: 'str' object has no attribute 'timetuple'</code></pre>
</div>
</div>
<div class="cell" data-execution_count="90">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1"></a>df.index.to_pydatetime()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="90">
<pre><code>array([datetime.datetime(2023, 1, 1, 0, 0),
       datetime.datetime(2023, 1, 2, 0, 0),
       datetime.datetime(2023, 1, 3, 0, 0),
       datetime.datetime(2023, 1, 4, 0, 0),
       datetime.datetime(2023, 1, 5, 0, 0),
       datetime.datetime(2023, 1, 6, 0, 0),
       datetime.datetime(2023, 1, 7, 0, 0),
       datetime.datetime(2023, 1, 8, 0, 0),
       datetime.datetime(2023, 1, 9, 0, 0),
       datetime.datetime(2023, 1, 10, 0, 0),
       datetime.datetime(2023, 1, 11, 0, 0),
       datetime.datetime(2023, 1, 12, 0, 0),
       datetime.datetime(2023, 1, 13, 0, 0),
       datetime.datetime(2023, 1, 14, 0, 0),
       datetime.datetime(2023, 1, 15, 0, 0),
       datetime.datetime(2023, 1, 16, 0, 0),
       datetime.datetime(2023, 1, 17, 0, 0),
       datetime.datetime(2023, 1, 18, 0, 0),
       datetime.datetime(2023, 1, 19, 0, 0),
       datetime.datetime(2023, 1, 20, 0, 0),
       datetime.datetime(2023, 1, 21, 0, 0),
       datetime.datetime(2023, 1, 22, 0, 0),
       datetime.datetime(2023, 1, 23, 0, 0),
       datetime.datetime(2023, 1, 24, 0, 0),
       datetime.datetime(2023, 1, 25, 0, 0),
       datetime.datetime(2023, 1, 26, 0, 0),
       datetime.datetime(2023, 1, 27, 0, 0),
       datetime.datetime(2023, 1, 28, 0, 0),
       datetime.datetime(2023, 1, 29, 0, 0),
       datetime.datetime(2023, 1, 30, 0, 0),
       datetime.datetime(2023, 1, 31, 0, 0),
       datetime.datetime(2023, 2, 1, 0, 0),
       datetime.datetime(2023, 2, 2, 0, 0),
       datetime.datetime(2023, 2, 3, 0, 0),
       datetime.datetime(2023, 2, 4, 0, 0),
       datetime.datetime(2023, 2, 5, 0, 0),
       datetime.datetime(2023, 2, 6, 0, 0),
       datetime.datetime(2023, 2, 7, 0, 0),
       datetime.datetime(2023, 2, 8, 0, 0),
       datetime.datetime(2023, 2, 9, 0, 0),
       datetime.datetime(2023, 2, 10, 0, 0),
       datetime.datetime(2023, 2, 11, 0, 0),
       datetime.datetime(2023, 2, 12, 0, 0),
       datetime.datetime(2023, 2, 13, 0, 0),
       datetime.datetime(2023, 2, 14, 0, 0),
       datetime.datetime(2023, 2, 15, 0, 0),
       datetime.datetime(2023, 2, 16, 0, 0),
       datetime.datetime(2023, 2, 17, 0, 0),
       datetime.datetime(2023, 2, 18, 0, 0),
       datetime.datetime(2023, 2, 19, 0, 0),
       datetime.datetime(2023, 2, 20, 0, 0),
       datetime.datetime(2023, 2, 21, 0, 0),
       datetime.datetime(2023, 2, 22, 0, 0),
       datetime.datetime(2023, 2, 23, 0, 0),
       datetime.datetime(2023, 2, 24, 0, 0),
       datetime.datetime(2023, 2, 25, 0, 0),
       datetime.datetime(2023, 2, 26, 0, 0),
       datetime.datetime(2023, 2, 27, 0, 0),
       datetime.datetime(2023, 2, 28, 0, 0),
       datetime.datetime(2023, 3, 1, 0, 0),
       datetime.datetime(2023, 3, 2, 0, 0),
       datetime.datetime(2023, 3, 3, 0, 0),
       datetime.datetime(2023, 3, 4, 0, 0),
       datetime.datetime(2023, 3, 5, 0, 0),
       datetime.datetime(2023, 3, 6, 0, 0),
       datetime.datetime(2023, 3, 7, 0, 0),
       datetime.datetime(2023, 3, 8, 0, 0),
       datetime.datetime(2023, 3, 9, 0, 0),
       datetime.datetime(2023, 3, 10, 0, 0),
       datetime.datetime(2023, 3, 11, 0, 0),
       datetime.datetime(2023, 3, 12, 0, 0),
       datetime.datetime(2023, 3, 13, 0, 0),
       datetime.datetime(2023, 3, 14, 0, 0),
       datetime.datetime(2023, 3, 15, 0, 0),
       datetime.datetime(2023, 3, 16, 0, 0),
       datetime.datetime(2023, 3, 17, 0, 0),
       datetime.datetime(2023, 3, 18, 0, 0),
       datetime.datetime(2023, 3, 19, 0, 0),
       datetime.datetime(2023, 3, 20, 0, 0),
       datetime.datetime(2023, 3, 21, 0, 0),
       datetime.datetime(2023, 3, 22, 0, 0),
       datetime.datetime(2023, 3, 23, 0, 0),
       datetime.datetime(2023, 3, 24, 0, 0),
       datetime.datetime(2023, 3, 25, 0, 0),
       datetime.datetime(2023, 3, 26, 0, 0),
       datetime.datetime(2023, 3, 27, 0, 0),
       datetime.datetime(2023, 3, 28, 0, 0),
       datetime.datetime(2023, 3, 29, 0, 0),
       datetime.datetime(2023, 3, 30, 0, 0),
       datetime.datetime(2023, 3, 31, 0, 0),
       datetime.datetime(2023, 4, 1, 0, 0),
       datetime.datetime(2023, 4, 2, 0, 0),
       datetime.datetime(2023, 4, 3, 0, 0),
       datetime.datetime(2023, 4, 4, 0, 0),
       datetime.datetime(2023, 4, 5, 0, 0),
       datetime.datetime(2023, 4, 6, 0, 0),
       datetime.datetime(2023, 4, 7, 0, 0),
       datetime.datetime(2023, 4, 8, 0, 0),
       datetime.datetime(2023, 4, 9, 0, 0),
       datetime.datetime(2023, 4, 10, 0, 0),
       datetime.datetime(2023, 4, 11, 0, 0),
       datetime.datetime(2023, 4, 12, 0, 0),
       datetime.datetime(2023, 4, 13, 0, 0),
       datetime.datetime(2023, 4, 14, 0, 0),
       datetime.datetime(2023, 4, 15, 0, 0),
       datetime.datetime(2023, 4, 16, 0, 0),
       datetime.datetime(2023, 4, 17, 0, 0),
       datetime.datetime(2023, 4, 18, 0, 0),
       datetime.datetime(2023, 4, 19, 0, 0),
       datetime.datetime(2023, 4, 20, 0, 0),
       datetime.datetime(2023, 4, 21, 0, 0),
       datetime.datetime(2023, 4, 22, 0, 0),
       datetime.datetime(2023, 4, 23, 0, 0),
       datetime.datetime(2023, 4, 24, 0, 0),
       datetime.datetime(2023, 4, 25, 0, 0),
       datetime.datetime(2023, 4, 26, 0, 0),
       datetime.datetime(2023, 4, 27, 0, 0),
       datetime.datetime(2023, 4, 28, 0, 0),
       datetime.datetime(2023, 4, 29, 0, 0),
       datetime.datetime(2023, 4, 30, 0, 0),
       datetime.datetime(2023, 5, 1, 0, 0),
       datetime.datetime(2023, 5, 2, 0, 0),
       datetime.datetime(2023, 5, 3, 0, 0),
       datetime.datetime(2023, 5, 4, 0, 0),
       datetime.datetime(2023, 5, 5, 0, 0),
       datetime.datetime(2023, 5, 6, 0, 0),
       datetime.datetime(2023, 5, 7, 0, 0),
       datetime.datetime(2023, 5, 8, 0, 0),
       datetime.datetime(2023, 5, 9, 0, 0),
       datetime.datetime(2023, 5, 10, 0, 0),
       datetime.datetime(2023, 5, 11, 0, 0),
       datetime.datetime(2023, 5, 12, 0, 0),
       datetime.datetime(2023, 5, 13, 0, 0),
       datetime.datetime(2023, 5, 14, 0, 0),
       datetime.datetime(2023, 5, 15, 0, 0),
       datetime.datetime(2023, 5, 16, 0, 0),
       datetime.datetime(2023, 5, 17, 0, 0),
       datetime.datetime(2023, 5, 18, 0, 0),
       datetime.datetime(2023, 5, 19, 0, 0),
       datetime.datetime(2023, 5, 20, 0, 0),
       datetime.datetime(2023, 5, 21, 0, 0),
       datetime.datetime(2023, 5, 22, 0, 0),
       datetime.datetime(2023, 5, 23, 0, 0),
       datetime.datetime(2023, 5, 24, 0, 0),
       datetime.datetime(2023, 5, 25, 0, 0),
       datetime.datetime(2023, 5, 26, 0, 0),
       datetime.datetime(2023, 5, 27, 0, 0),
       datetime.datetime(2023, 5, 28, 0, 0),
       datetime.datetime(2023, 5, 29, 0, 0),
       datetime.datetime(2023, 5, 30, 0, 0),
       datetime.datetime(2023, 5, 31, 0, 0),
       datetime.datetime(2023, 6, 1, 0, 0),
       datetime.datetime(2023, 6, 2, 0, 0),
       datetime.datetime(2023, 6, 3, 0, 0),
       datetime.datetime(2023, 6, 4, 0, 0),
       datetime.datetime(2023, 6, 5, 0, 0),
       datetime.datetime(2023, 6, 6, 0, 0),
       datetime.datetime(2023, 6, 7, 0, 0),
       datetime.datetime(2023, 6, 8, 0, 0),
       datetime.datetime(2023, 6, 9, 0, 0),
       datetime.datetime(2023, 6, 10, 0, 0),
       datetime.datetime(2023, 6, 11, 0, 0),
       datetime.datetime(2023, 6, 12, 0, 0),
       datetime.datetime(2023, 6, 13, 0, 0),
       datetime.datetime(2023, 6, 14, 0, 0),
       datetime.datetime(2023, 6, 15, 0, 0),
       datetime.datetime(2023, 6, 16, 0, 0),
       datetime.datetime(2023, 6, 17, 0, 0),
       datetime.datetime(2023, 6, 18, 0, 0),
       datetime.datetime(2023, 6, 19, 0, 0),
       datetime.datetime(2023, 6, 20, 0, 0),
       datetime.datetime(2023, 6, 21, 0, 0),
       datetime.datetime(2023, 6, 22, 0, 0),
       datetime.datetime(2023, 6, 23, 0, 0),
       datetime.datetime(2023, 6, 24, 0, 0),
       datetime.datetime(2023, 6, 25, 0, 0),
       datetime.datetime(2023, 6, 26, 0, 0),
       datetime.datetime(2023, 6, 27, 0, 0),
       datetime.datetime(2023, 6, 28, 0, 0),
       datetime.datetime(2023, 6, 29, 0, 0),
       datetime.datetime(2023, 6, 30, 0, 0),
       datetime.datetime(2023, 7, 1, 0, 0),
       datetime.datetime(2023, 7, 2, 0, 0),
       datetime.datetime(2023, 7, 3, 0, 0),
       datetime.datetime(2023, 7, 4, 0, 0),
       datetime.datetime(2023, 7, 5, 0, 0),
       datetime.datetime(2023, 7, 6, 0, 0),
       datetime.datetime(2023, 7, 7, 0, 0),
       datetime.datetime(2023, 7, 8, 0, 0),
       datetime.datetime(2023, 7, 9, 0, 0),
       datetime.datetime(2023, 7, 10, 0, 0),
       datetime.datetime(2023, 7, 11, 0, 0),
       datetime.datetime(2023, 7, 12, 0, 0),
       datetime.datetime(2023, 7, 13, 0, 0),
       datetime.datetime(2023, 7, 14, 0, 0),
       datetime.datetime(2023, 7, 15, 0, 0),
       datetime.datetime(2023, 7, 16, 0, 0),
       datetime.datetime(2023, 7, 17, 0, 0),
       datetime.datetime(2023, 7, 18, 0, 0),
       datetime.datetime(2023, 7, 19, 0, 0),
       datetime.datetime(2023, 7, 20, 0, 0),
       datetime.datetime(2023, 7, 21, 0, 0),
       datetime.datetime(2023, 7, 22, 0, 0),
       datetime.datetime(2023, 7, 23, 0, 0),
       datetime.datetime(2023, 7, 24, 0, 0),
       datetime.datetime(2023, 7, 25, 0, 0),
       datetime.datetime(2023, 7, 26, 0, 0),
       datetime.datetime(2023, 7, 27, 0, 0),
       datetime.datetime(2023, 7, 28, 0, 0),
       datetime.datetime(2023, 7, 29, 0, 0),
       datetime.datetime(2023, 7, 30, 0, 0),
       datetime.datetime(2023, 7, 31, 0, 0),
       datetime.datetime(2023, 8, 1, 0, 0),
       datetime.datetime(2023, 8, 2, 0, 0),
       datetime.datetime(2023, 8, 3, 0, 0),
       datetime.datetime(2023, 8, 4, 0, 0),
       datetime.datetime(2023, 8, 5, 0, 0),
       datetime.datetime(2023, 8, 6, 0, 0),
       datetime.datetime(2023, 8, 7, 0, 0),
       datetime.datetime(2023, 8, 8, 0, 0),
       datetime.datetime(2023, 8, 9, 0, 0),
       datetime.datetime(2023, 8, 10, 0, 0),
       datetime.datetime(2023, 8, 11, 0, 0),
       datetime.datetime(2023, 8, 12, 0, 0),
       datetime.datetime(2023, 8, 13, 0, 0),
       datetime.datetime(2023, 8, 14, 0, 0),
       datetime.datetime(2023, 8, 15, 0, 0),
       datetime.datetime(2023, 8, 16, 0, 0),
       datetime.datetime(2023, 8, 17, 0, 0),
       datetime.datetime(2023, 8, 18, 0, 0),
       datetime.datetime(2023, 8, 19, 0, 0),
       datetime.datetime(2023, 8, 20, 0, 0),
       datetime.datetime(2023, 8, 21, 0, 0),
       datetime.datetime(2023, 8, 22, 0, 0),
       datetime.datetime(2023, 8, 23, 0, 0),
       datetime.datetime(2023, 8, 24, 0, 0),
       datetime.datetime(2023, 8, 25, 0, 0),
       datetime.datetime(2023, 8, 26, 0, 0),
       datetime.datetime(2023, 8, 27, 0, 0),
       datetime.datetime(2023, 8, 28, 0, 0),
       datetime.datetime(2023, 8, 29, 0, 0),
       datetime.datetime(2023, 8, 30, 0, 0),
       datetime.datetime(2023, 8, 31, 0, 0),
       datetime.datetime(2023, 9, 1, 0, 0),
       datetime.datetime(2023, 9, 2, 0, 0),
       datetime.datetime(2023, 9, 3, 0, 0),
       datetime.datetime(2023, 9, 4, 0, 0),
       datetime.datetime(2023, 9, 5, 0, 0),
       datetime.datetime(2023, 9, 6, 0, 0),
       datetime.datetime(2023, 9, 7, 0, 0),
       datetime.datetime(2023, 9, 8, 0, 0),
       datetime.datetime(2023, 9, 9, 0, 0),
       datetime.datetime(2023, 9, 10, 0, 0),
       datetime.datetime(2023, 9, 11, 0, 0),
       datetime.datetime(2023, 9, 12, 0, 0),
       datetime.datetime(2023, 9, 13, 0, 0),
       datetime.datetime(2023, 9, 14, 0, 0),
       datetime.datetime(2023, 9, 15, 0, 0),
       datetime.datetime(2023, 9, 16, 0, 0),
       datetime.datetime(2023, 9, 17, 0, 0),
       datetime.datetime(2023, 9, 18, 0, 0),
       datetime.datetime(2023, 9, 19, 0, 0),
       datetime.datetime(2023, 9, 20, 0, 0),
       datetime.datetime(2023, 9, 21, 0, 0),
       datetime.datetime(2023, 9, 22, 0, 0),
       datetime.datetime(2023, 9, 23, 0, 0),
       datetime.datetime(2023, 9, 24, 0, 0),
       datetime.datetime(2023, 9, 25, 0, 0),
       datetime.datetime(2023, 9, 26, 0, 0),
       datetime.datetime(2023, 9, 27, 0, 0),
       datetime.datetime(2023, 9, 28, 0, 0),
       datetime.datetime(2023, 9, 29, 0, 0),
       datetime.datetime(2023, 9, 30, 0, 0),
       datetime.datetime(2023, 10, 1, 0, 0),
       datetime.datetime(2023, 10, 2, 0, 0),
       datetime.datetime(2023, 10, 3, 0, 0),
       datetime.datetime(2023, 10, 4, 0, 0),
       datetime.datetime(2023, 10, 5, 0, 0),
       datetime.datetime(2023, 10, 6, 0, 0),
       datetime.datetime(2023, 10, 7, 0, 0),
       datetime.datetime(2023, 10, 8, 0, 0),
       datetime.datetime(2023, 10, 9, 0, 0),
       datetime.datetime(2023, 10, 10, 0, 0),
       datetime.datetime(2023, 10, 11, 0, 0),
       datetime.datetime(2023, 10, 12, 0, 0),
       datetime.datetime(2023, 10, 13, 0, 0),
       datetime.datetime(2023, 10, 14, 0, 0),
       datetime.datetime(2023, 10, 15, 0, 0),
       datetime.datetime(2023, 10, 16, 0, 0),
       datetime.datetime(2023, 10, 17, 0, 0),
       datetime.datetime(2023, 10, 18, 0, 0),
       datetime.datetime(2023, 10, 19, 0, 0),
       datetime.datetime(2023, 10, 20, 0, 0),
       datetime.datetime(2023, 10, 21, 0, 0),
       datetime.datetime(2023, 10, 22, 0, 0),
       datetime.datetime(2023, 10, 23, 0, 0),
       datetime.datetime(2023, 10, 24, 0, 0),
       datetime.datetime(2023, 10, 25, 0, 0),
       datetime.datetime(2023, 10, 26, 0, 0),
       datetime.datetime(2023, 10, 27, 0, 0),
       datetime.datetime(2023, 10, 28, 0, 0),
       datetime.datetime(2023, 10, 29, 0, 0),
       datetime.datetime(2023, 10, 30, 0, 0),
       datetime.datetime(2023, 10, 31, 0, 0),
       datetime.datetime(2023, 11, 1, 0, 0),
       datetime.datetime(2023, 11, 2, 0, 0),
       datetime.datetime(2023, 11, 3, 0, 0),
       datetime.datetime(2023, 11, 4, 0, 0),
       datetime.datetime(2023, 11, 5, 0, 0),
       datetime.datetime(2023, 11, 6, 0, 0),
       datetime.datetime(2023, 11, 7, 0, 0),
       datetime.datetime(2023, 11, 8, 0, 0),
       datetime.datetime(2023, 11, 9, 0, 0),
       datetime.datetime(2023, 11, 10, 0, 0),
       datetime.datetime(2023, 11, 11, 0, 0),
       datetime.datetime(2023, 11, 12, 0, 0),
       datetime.datetime(2023, 11, 13, 0, 0),
       datetime.datetime(2023, 11, 14, 0, 0),
       datetime.datetime(2023, 11, 15, 0, 0),
       datetime.datetime(2023, 11, 16, 0, 0),
       datetime.datetime(2023, 11, 17, 0, 0),
       datetime.datetime(2023, 11, 18, 0, 0),
       datetime.datetime(2023, 11, 19, 0, 0),
       datetime.datetime(2023, 11, 20, 0, 0),
       datetime.datetime(2023, 11, 21, 0, 0),
       datetime.datetime(2023, 11, 22, 0, 0),
       datetime.datetime(2023, 11, 23, 0, 0),
       datetime.datetime(2023, 11, 24, 0, 0),
       datetime.datetime(2023, 11, 25, 0, 0),
       datetime.datetime(2023, 11, 26, 0, 0),
       datetime.datetime(2023, 11, 27, 0, 0),
       datetime.datetime(2023, 11, 28, 0, 0),
       datetime.datetime(2023, 11, 29, 0, 0),
       datetime.datetime(2023, 11, 30, 0, 0),
       datetime.datetime(2023, 12, 1, 0, 0),
       datetime.datetime(2023, 12, 2, 0, 0),
       datetime.datetime(2023, 12, 3, 0, 0),
       datetime.datetime(2023, 12, 4, 0, 0),
       datetime.datetime(2023, 12, 5, 0, 0),
       datetime.datetime(2023, 12, 6, 0, 0),
       datetime.datetime(2023, 12, 7, 0, 0),
       datetime.datetime(2023, 12, 8, 0, 0),
       datetime.datetime(2023, 12, 9, 0, 0),
       datetime.datetime(2023, 12, 10, 0, 0),
       datetime.datetime(2023, 12, 11, 0, 0),
       datetime.datetime(2023, 12, 12, 0, 0),
       datetime.datetime(2023, 12, 13, 0, 0),
       datetime.datetime(2023, 12, 14, 0, 0),
       datetime.datetime(2023, 12, 15, 0, 0),
       datetime.datetime(2023, 12, 16, 0, 0),
       datetime.datetime(2023, 12, 17, 0, 0),
       datetime.datetime(2023, 12, 18, 0, 0),
       datetime.datetime(2023, 12, 19, 0, 0),
       datetime.datetime(2023, 12, 20, 0, 0),
       datetime.datetime(2023, 12, 21, 0, 0),
       datetime.datetime(2023, 12, 22, 0, 0),
       datetime.datetime(2023, 12, 23, 0, 0),
       datetime.datetime(2023, 12, 24, 0, 0),
       datetime.datetime(2023, 12, 25, 0, 0),
       datetime.datetime(2023, 12, 26, 0, 0),
       datetime.datetime(2023, 12, 27, 0, 0),
       datetime.datetime(2023, 12, 28, 0, 0),
       datetime.datetime(2023, 12, 29, 0, 0),
       datetime.datetime(2023, 12, 30, 0, 0),
       datetime.datetime(2023, 12, 31, 0, 0)], dtype=object)</code></pre>
</div>
</div>
<div class="cell" data-execution_count="98">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1"></a>unix <span class="op">=</span> df.index.view(<span class="st">'int64'</span>) <span class="op">/</span> <span class="fl">1e9</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell" data-execution_count="101">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1"></a>unix[<span class="dv">0</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="101">
<pre><code>1672531200.0</code></pre>
</div>
</div>
<div class="cell" data-execution_count="99">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode numberSource python number-lines code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1"></a>pd.to_datetime(unix, unit<span class="op">=</span><span class="st">'s'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display" data-execution_count="99">
<pre><code>DatetimeIndex(['2023-01-01', '2023-01-02', '2023-01-03', '2023-01-04',
               '2023-01-05', '2023-01-06', '2023-01-07', '2023-01-08',
               '2023-01-09', '2023-01-10',
               ...
               '2023-12-22', '2023-12-23', '2023-12-24', '2023-12-25',
               '2023-12-26', '2023-12-27', '2023-12-28', '2023-12-29',
               '2023-12-30', '2023-12-31'],
              dtype='datetime64[ns]', length=365, freq=None)</code></pre>
</div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  const viewSource = window.document.getElementById('quarto-view-source') ||
                     window.document.getElementById('quarto-code-tools-source');
  if (viewSource) {
    const sourceUrl = viewSource.getAttribute("data-quarto-source-url");
    viewSource.addEventListener("click", function(e) {
      if (sourceUrl) {
        // rstudio viewer pane
        if (/\bcapabilities=\b/.test(window.location)) {
          window.open(sourceUrl);
        } else {
          window.location.href = sourceUrl;
        }
      } else {
        const modal = new bootstrap.Modal(document.getElementById('quarto-embedded-source-code-modal'));
        modal.show();
      }
      return false;
    });
  }
  function toggleCodeHandler(show) {
    return function(e) {
      const detailsSrc = window.document.querySelectorAll(".cell > details > .sourceCode");
      for (let i=0; i<detailsSrc.length; i++) {
        const details = detailsSrc[i].parentElement;
        if (show) {
          details.open = true;
        } else {
          details.removeAttribute("open");
        }
      }
      const cellCodeDivs = window.document.querySelectorAll(".cell > .sourceCode");
      const fromCls = show ? "hidden" : "unhidden";
      const toCls = show ? "unhidden" : "hidden";
      for (let i=0; i<cellCodeDivs.length; i++) {
        const codeDiv = cellCodeDivs[i];
        if (codeDiv.classList.contains(fromCls)) {
          codeDiv.classList.remove(fromCls);
          codeDiv.classList.add(toCls);
        } 
      }
      return false;
    }
  }
  const hideAllCode = window.document.getElementById("quarto-hide-all-code");
  if (hideAllCode) {
    hideAllCode.addEventListener("click", toggleCodeHandler(false));
  }
  const showAllCode = window.document.getElementById("quarto-show-all-code");
  if (showAllCode) {
    showAllCode.addEventListener("click", toggleCodeHandler(true));
  }
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../behind-the-scenes/consecutive_sequence.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text"><span class="chapter-number">58</span>&nbsp; <span class="chapter-title">remove consecutive values</span></span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../behind-the-scenes/make_your_own_website.html" class="pagination-link">
        <span class="nav-page-text">make your own website</span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>